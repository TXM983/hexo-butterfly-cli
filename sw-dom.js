document.addEventListener("DOMContentLoaded",(()=>{if(!navigator.serviceWorker?.controller)return;const e=e=>{const t=e.endsWith("js")?"script":"link",o="link"===t?"href":"src";for(let n of document.getElementsByTagName(t)){const r=n[o];if(e.length>r?e.endsWith(r):r.endsWith(e)){const e=document.createElement(t),o=n.text||n.textContent||n.innerHTML||"";return Array.from(n.attributes).forEach((t=>e.setAttribute(t.name,t.value))),e.appendChild(document.createTextNode(o)),n.parentNode.replaceChildren(e,n),!0}}},t="updated",o=()=>{caches.match("https://id.v3/").then((function(e){e?e.json().then((async e=>{const t=await Toastify({text:"",duration:7e3,gravity:"top",position:"left",stopOnFocus:!1,style:{width:"auto",padding:"0",borderRadius:"8px",textAlign:"left",boxShadow:"0 3px 7px 0 rgba(0,0,0,.25)",background:"linear-gradient(145deg, #ffffff, #f8f9fa)",color:"#2d3436",maxWidth:"480px",border:"1px solid rgba(0, 0, 0, 0.08)",overflow:"hidden",backdropFilter:"blur(4px)"},node:(()=>{const e=document.createElement("div");e.style.padding="16px 20px";const o=document.createElement("div");o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.marginBottom="12px";const n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.gap="12px";const r=document.createElement("i");r.className="fas fa-check-circle",r.style.color="var(--theme-color)",r.style.fontSize="20px";const s=document.createElement("div");s.textContent="通知📢",s.style.fontWeight="600",s.style.fontSize="17px",s.style.color="#2d3436",s.style.letterSpacing="0.3px",n.appendChild(r),n.appendChild(s);const l=document.createElement("div");l.innerHTML="<i class='fas fa-times'></i>",l.style.cursor="pointer",l.style.padding="4px",l.style.borderRadius="50%",l.style.transition="all 0.2s",l.style.color="var(--theme-color)",l.style.fontSize="16px",o.appendChild(n),o.appendChild(l);const a=document.createElement("div");a.textContent="当前已自动为您刷新Service Worker缓存！若页面显示异常，请按Ctrl+F5刷新！",a.style.fontSize="15px",a.style.lineHeight="1.5",a.style.color="#495057",a.style.paddingLeft="32px";const i=document.createElement("div");return i.style.height="3px",i.style.background="var(--theme-color)",i.style.position="absolute",i.style.bottom="0",i.style.left="0",i.style.width="100%",i.style.animation="progressToast 7000ms linear  1 forwards",e.appendChild(o),e.appendChild(a),e.appendChild(i),l.addEventListener("click",(()=>t.hideToast())),e})()}).showToast();await console.log.bind(console,`\n %c 通知📢 %c 已刷新Service Worker缓存 %c 当前版本: ${e.local.toString().length>=3?e.local.toString().slice(0,-2)+"."+e.local.toString().slice(-2):e.global+"."+e.local} \n`,"color: #ffffff; background: linear-gradient(90deg, #ff4b1f, #ff9068); padding:5px 0; border-radius: 5px;","color: #ffffff; background: linear-gradient(90deg, #11998e, #38ef7d); padding:5px 0; border-radius: 5px;","color: #000000; background: #f5f7fa; padding:5px 0; border-radius: 5px;")})):console.info("未找到匹配的缓存响应")})).catch((function(e){console.error("缓存匹配出错:",e)}))};var n;sessionStorage.getItem(t)?(o(),sessionStorage.removeItem(t)):(n="update",navigator.serviceWorker.controller.postMessage(n)),navigator.serviceWorker.addEventListener("message",(n=>{const r=n.data;sessionStorage.setItem(t,r.type);const s=r.list?.filter((e=>/\.(js|css)$/.test(e)));if(s)window.Pjax?.isSupported?.()&&s.forEach(e),location.reload();else{const e=r.new,n=r.old;!n||e.global===n.global&&e.local===n.local||o(),sessionStorage.removeItem(t)}}))}));