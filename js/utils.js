(()=>{const e={debounce:(e,t=0,n=!1)=>{let o;return(...i)=>{const s=n&&!o;clearTimeout(o),o=setTimeout((()=>{o=null,n||e(...i)}),t),s&&e(...i)}},throttle:function(e,t,n={}){let o,i,s,a=0;const r=()=>{a=!1===n.leading?0:(new Date).getTime(),o=null,e.apply(i,s),o||(i=s=null)};return(...l)=>{const d=(new Date).getTime();a||!1!==n.leading||(a=d);const c=t-(d-a);i=this,s=l,c<=0||c>t?(o&&(clearTimeout(o),o=null),a=d,e.apply(i,s),o||(i=s=null)):o||!1===n.trailing||(o=setTimeout(r,c))}},addEventListenerPjax:(e,t,n,o,i=!1)=>{btf.addGlobalListener(e,t,n,o,i),t instanceof NodeList?t.forEach((t=>{btf.addGlobalFn("pjaxSendOnce",(()=>{t.removeEventListener(e,n,i)}))})):btf.addGlobalFn("pjaxSendOnce",(()=>{t.removeEventListener(e,n,i)}))},removeGlobalFnEvent:(e,t=window)=>{const n=t.globalFn||{},o=n[e];o&&(Object.keys(o).forEach((e=>o[e]())),delete n[e])},overflowPaddingR:{add:()=>{const e=window.innerWidth-document.body.clientWidth;if(e>0){document.body.style.paddingRight=`${e}px`,document.body.style.overflow="hidden";const t=document.querySelector("#page-header.nav-fixed #menus");t&&(t.style.paddingRight=`${e}px`)}},remove:()=>{document.body.style.paddingRight="",document.body.style.overflow="";const e=document.querySelector("#page-header.nav-fixed #menus");e&&(e.style.paddingRight="")}},diffDate:(e,t=!1)=>{const n=new Date,o=new Date(e),i=(n-o)/1e3/60,s=i/60,a=s/24,r=a/30,{dateSuffix:l}=GLOBAL_CONFIG;return t?r>12?o.toISOString().slice(0,10):r>=1?`${Math.floor(r)} ${l.month}`:a>=1?`${Math.floor(a)} ${l.day}`:s>=1?`${Math.floor(s)} ${l.hour}`:i>=1?`${Math.floor(i)} ${l.min}`:l.just:Math.floor(a)},loadComment:(e,t)=>{if("IntersectionObserver"in window){const n=new IntersectionObserver((e=>{e[0].isIntersecting&&(t(),n.disconnect())}),{threshold:[0]});n.observe(e)}else t()},scrollToDest:(e,t=500)=>{const n=window.scrollY;if(n>e&&(e-=70),"scrollBehavior"in document.documentElement.style)return void window.scrollTo({top:e,behavior:"smooth"});const o=performance.now(),i=s=>{const a=s-o,r=Math.min(a/t,1);window.scrollTo(0,n+(e-n)*r),r<1&&requestAnimationFrame(i)};requestAnimationFrame(i)},animateIn:(e,t)=>{e.style.display="block",e.style.animation=t},animateOut:(e,t)=>{const n=()=>{e.style.display="",e.style.animation="",e.removeEventListener("animationend",n)};e.addEventListener("animationend",n),e.style.animation=t},getParents:(e,t)=>{for(;e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null},siblings:(e,t)=>[...e.parentNode.children].filter((n=>t?n!==e&&n.matches(t):n!==e)),wrap:(e,t,n)=>{const o=document.createElement(t);for(const[e,t]of Object.entries(n))o.setAttribute(e,t);e.parentNode.insertBefore(o,e),o.appendChild(e)},unwrap:e=>{const t=e.parentNode;t!==document.body&&(t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t))},isHidden:e=>0===e.offsetHeight&&0===e.offsetWidth,getEleTop:e=>{let t=e.offsetTop,n=e.offsetParent;for(;null!==n;)t+=n.offsetTop,n=n.offsetParent;return t},loadLightbox:e=>{const t=GLOBAL_CONFIG.lightbox;"medium_zoom"===t&&mediumZoom(e,{background:"var(--zoom-bg)"}),"fancybox"===t&&(Array.from(e).forEach((e=>{if("A"!==e.parentNode.tagName){const t=e.dataset.lazySrc||e.src,n=e.title||e.alt||"";btf.wrap(e,"a",{href:t,"data-fancybox":"gallery","data-caption":n,"data-thumb":t})}})),window.fancyboxRun||(Fancybox.bind("[data-fancybox]",{Hash:!1,Thumbs:{showOnStart:!1},Images:{Panzoom:{maxScale:4}},Carousel:{transition:"slide"},Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","thumbs","close"]}}}),window.fancyboxRun=!0))},initJustifiedGallery:function(e){e.forEach((function(e){btf.isHidden(e)||fjGallery(e,{itemSelector:".fj-gallery-item",rowHeight:220,gutter:4,onJustify:function(){this.$container.style.opacity="1"}})}))},setLoading:{add:e=>{e.insertAdjacentHTML("afterend",'\n        <div class="loading-container">\n          <div class="loading-item">\n            <div></div><div></div><div></div><div></div><div></div>\n          </div>\n        </div>\n      ')},remove:e=>{e.nextElementSibling.remove()}},setMusicLoading:{add:e=>{e.insertAdjacentHTML("afterend",'<div class="loader">\n                                          <div class="music-note">\n                                            <svg viewBox="0 0 64 64" width="50" height="50" xmlns="http://www.w3.org/2000/svg">\n                                              <defs>\n                                                <linearGradient id="gradient" x1="0" y1="0" x2="1" y2="1">\n                                                  <stop offset="0%" stop-color="#bb86fc"/>\n                                                  <stop offset="100%" stop-color="#6200ee"/>\n                                                </linearGradient>\n                                              </defs>\n                                              <path d="M22 14v29a8 8 0 1 0 4-6.9V12h10v6l8-3v-7H22z"/>\n                                            </svg>\n                                          </div>\n                                        \n                                          <div class="pulse-ring"></div>\n                                          <div class="pulse-ring"></div>\n                                          <div class="pulse-ring"></div>\n                                        \n                                          <div class="spectrum">\n                                            <div class="bar"></div>\n                                            <div class="bar"></div>\n                                            <div class="bar"></div>\n                                            <div class="bar"></div>\n                                            <div class="bar"></div>\n                                          </div>\n                                        </div>')},remove:e=>{e.nextElementSibling.remove()}},updateAnchor:e=>{if(e!==window.location.hash){e||(e=location.pathname);const t=GLOBAL_CONFIG_SITE.title;window.history.replaceState({url:location.href,title:t},t,e)}},getScrollPercent:(()=>{let e,t,n,o;return(i,s)=>{e&&s.clientHeight===e||(e=s.clientHeight,t=window.innerHeight,n=s.offsetTop,o=Math.max(e-t,document.documentElement.scrollHeight-t));const a=(i-n)/o;return Math.max(0,Math.min(100,Math.round(100*a)))}})(),linkCom:e=>{const t=document.querySelector(".el-textarea__inner");"bf"===e?(t.value="```yml\n",t.value+="- name: \n  link: \n  avatar: \n  descr: \n  siteshot: ",t.value+="\n```",t.setSelectionRange(15,15)):(t.value="ç«™ç‚¹åç§°ï¼š\nç«™ç‚¹åœ°å€ï¼š\nå¤´åƒé“¾æŽ¥ï¼š\nç«™ç‚¹æè¿°ï¼š\nç«™ç‚¹æˆªå›¾ï¼š",t.setSelectionRange(5,5)),t.focus()},hasMobile:()=>{let e=!1;return(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)||document.body.clientWidth<800)&&(e=!0),e},initItem:e=>{localStorage.setItem("blogbg","default"),localStorage.setItem("universe","block"),localStorage.setItem("blur","0"),localStorage.setItem("fpson","1"),localStorage.setItem("transNum","85"),localStorage.setItem("blurRad","20"),localStorage.setItem("font","LXGW"),localStorage.setItem("themeColor","green"),localStorage.setItem("rs","block"),localStorage.setItem("mouse","on"),localStorage.setItem("light","true"),localStorage.setItem("snow","none"),localStorage.setItem("aside","1"),localStorage.setItem("asidePos","1"),localStorage.setItem("nav","1"),localStorage.setItem("defaultMusic",JSON.stringify(e)),localStorage.setItem("localMusic",JSON.stringify(e)),localStorage.removeItem("shuffledPlaylist"),localStorage.removeItem("shuffledMusicList")},$notify:(e,t,n,o=5e3)=>{const i=Toastify({text:"",duration:o,gravity:"top",position:"left",stopOnFocus:!1,style:{width:"auto",padding:"0",borderRadius:"8px",textAlign:"left",boxShadow:"0 3px 7px 0 rgba(0, 0, 0, .25)",background:"linear-gradient(145deg, #ffffff, #f8f9fa)",color:"#2d3436",maxWidth:"300px",border:"1px solid rgba(0, 0, 0, 0.08)",overflow:"hidden",backdropFilter:"blur(4px)"},node:(()=>{const s=document.createElement("div");s.style.padding="16px 25px";const a=document.createElement("div");a.style.display="flex",a.style.justifyContent="space-between",a.style.alignItems="center",a.style.marginBottom="12px";const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="12px";const l=document.createElement("i");switch(n){case"success":default:l.className="fas fa-check-circle";break;case"error":l.className="fas fa-times-circle";break;case"warning":l.className="fas fa-exclamation-circle"}l.style.color="var(--theme-color)",l.style.fontSize="20px";const d=document.createElement("div");d.textContent=e,d.style.fontWeight="600",d.style.fontSize="17px",d.style.color="#2d3436",d.style.letterSpacing="0.3px",r.appendChild(l),r.appendChild(d);const c=document.createElement("div");c.innerHTML="<i class='fas fa-times'></i>",c.style.cursor="pointer",c.style.padding="4px",c.style.borderRadius="50%",c.style.transition="all 0.2s",c.style.color="var(--theme-color)",c.style.fontSize="16px",a.appendChild(r),a.appendChild(c);const h=document.createElement("div");h.textContent=t,h.style.fontSize="15px",h.style.lineHeight="1.5",h.style.color="#495057",h.style.paddingLeft="32px";const m=document.createElement("div");return m.style.height="3px",m.style.background="var(--theme-color)",m.style.position="absolute",m.style.bottom="0",m.style.left="0",m.style.width="100%",m.style.animation=`progressToast ${o}ms linear  1 forwards`,s.appendChild(a),s.appendChild(h),s.appendChild(m),c.addEventListener("click",(()=>i.hideToast())),s})()}).showToast()},snowflake:()=>{btf.hasMobile()||"block"!==localStorage.getItem("snow")||"light"!==document.documentElement.getAttribute("data-theme")||window&&(()=>{const e=(e,n,o,i,s,a,r)=>{const l=2*Math.PI/6;e.save(),e.translate(n,o),e.rotate(r),e.strokeStyle="rgba("+s+", "+a+")",e.lineWidth=.05*i;for(let n=0;n<6;n++)e.rotate(l),t(e,i);e.restore()},t=(e,t)=>{const n=1.3*t,o=.4*n,i=Math.PI/6;e.beginPath(),e.moveTo(0,0),e.lineTo(0,-n),e.stroke();for(let t=1;t<=6;t++){const s=n/7*t,a=Math.PI/16;e.beginPath(),e.moveTo(0,-s),e.lineTo(-o*Math.sin(i+a*t),-s-o*Math.cos(i+a*t)),e.stroke(),e.beginPath(),e.moveTo(0,-s),e.lineTo(o*Math.sin(i-a*t),-s-o*Math.cos(i-a*t)),e.stroke(),t%2==0&&(e.beginPath(),e.moveTo(o*Math.sin(i-a*t),-s-o*Math.cos(i-a*t)),e.lineTo(1.2*o*Math.sin(i-a*t+Math.PI/12),-s-1.2*o*Math.cos(i-a*t+Math.PI/12)),e.stroke())}const s=.2*n;for(let t=1;t<=4;t++){const o=n/5*t,a=Math.PI/20;e.beginPath(),e.moveTo(0,-o),e.lineTo(s*Math.sin(i+a*t),-o-s*Math.cos(i+a*t)),e.stroke(),e.beginPath(),e.moveTo(0,-o),e.lineTo(-s*Math.sin(i-a*t),-o-s*Math.cos(i-a*t)),e.stroke()}},n=(e,t,n,i,s,a,r)=>{const l=2*Math.PI/6;e.save(),e.translate(t,n),e.rotate(r),e.strokeStyle="rgba("+s+", "+a+")",e.lineWidth=.05*i;for(let t=0;t<6;t++)e.rotate(l),o(e,i);e.restore()},o=(e,t)=>{const n=1.3*t,o=Math.PI/6;e.beginPath(),e.moveTo(0,0),e.lineTo(0,-n),e.stroke();for(let t=1;t<=10;t++){const i=n/11*t,s=o+.1*t;e.beginPath(),e.moveTo(0,-i),e.lineTo(-i*Math.sin(s),-i-i*Math.cos(s)),e.stroke(),e.beginPath(),e.moveTo(0,-i),e.lineTo(i*Math.sin(s),-i-i*Math.cos(s)),e.stroke()}const i=.2*n;for(let t=1;t<=4;t++){const s=n/5*t,a=o+.1*t*1.5;e.beginPath(),e.moveTo(0,-s),e.lineTo(i*Math.sin(a),-s-i*Math.cos(a)),e.stroke(),e.beginPath(),e.moveTo(0,-s),e.lineTo(-i*Math.sin(a),-s-i*Math.cos(a)),e.stroke()}},i=(e,t,n,o,i,a,r)=>{const l=2*Math.PI/6;e.save(),e.translate(t,n),e.rotate(r),e.strokeStyle="rgba("+i+", "+a+")",e.lineWidth=.05*o;for(let t=0;t<6;t++)e.rotate(l),s(e,o);e.restore()},s=(e,t)=>{const n=1.2*t;e.beginPath(),e.moveTo(0,0),e.lineTo(0,-n),e.stroke(),a(e,n,0)},a=(e,t,n)=>{if(n>2)return;const o=.6*t,i=Math.PI/6;for(let s=0;s<3;s++){const r=i*(s-1);e.beginPath(),e.moveTo(0,-t),e.lineTo(o*Math.sin(r),-t-o*Math.cos(r)),e.stroke(),a(e,o,n+1)}},r={flakeCount:50,minDist:150,color:"255, 255, 255",size:6,speed:.5,opacity:.6,stepsize:.5,rotation:2*Math.PI,rotationSpeed:.02,snowflakeMethod:e},l=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},d=document.getElementById("snow"),c=d.getContext("2d"),h=r.flakeCount;let m=-100,u=-100,f=[];d.width=window.innerWidth,d.height=window.innerHeight;const p=()=>{c.clearRect(0,0,d.width,d.height);const e=r.minDist;for(let t=0;t<h;t++){let n=f[t];const o=m,i=u,s=n.x,a=n.y,l=Math.sqrt((o-s)*(o-s)+(i-a)*(i-a));if(l<e){const t=(o-s)/l,r=(i-a)/l,d=e/(l*l)/2;n.velX-=d*t,n.velY-=d*r}else n.velX*=.98,n.velY<n.speed&&n.speed-n.velY>.01&&(n.velY+=.01*(n.speed-n.velY)),n.velX+=Math.cos(n.step+=.05)*n.stepSize;n.rotation+=n.rotationSpeed,n.y+=n.velY,n.x+=n.velX,(n.y>=d.height||n.y<=0)&&(n.opacity-=.02,n.opacity<=0&&g(n)),(n.x>=d.width||n.x<=0)&&(n.opacity-=.02,n.opacity<=0&&g(n)),n.snowflakeMethod(c,n.x,n.y,n.size,r.color,n.opacity,n.rotation)}btf.snowId=l(p)};btf.addGlobalListener("visibilitychange",document,(()=>{document.hidden?(window.cancelAnimationFrame(btf.snowId),c.clearRect(0,0,d.width,d.height),btf.snowId=null):btf.snowId||(btf.snowId=l(p))}),"snowVisibilitychange");const g=t=>{t.x=Math.floor(Math.random()*d.width),t.y=0,t.size=4*Math.random()+r.size,t.speed=Math.random()+r.speed,t.velY=t.speed,t.velX=0,t.opacity=.6*Math.random()+r.opacity,t.rotation=Math.random()*r.rotation,t.rotationSpeed=(Math.random()-.5)*r.rotationSpeed,t.snowflakeMethod=(()=>{const t=[e,n,i];return t[Math.floor(Math.random()*t.length)]})()};btf.addGlobalListener("mousemove",document,(e=>{m=e.clientX,u=e.clientY}),"snowMouseMove");const b=btf.throttle((()=>{d.width=window.innerWidth,d.height=window.innerHeight}),200);btf.addGlobalListener("resize",window,b,"snowResize"),(()=>{for(let e=0;e<h;e++)f.push({speed:Math.random()+r.speed,velX:0,velY:Math.random()+r.speed,x:Math.floor(Math.random()*d.width),y:Math.floor(Math.random()*d.height),size:4*Math.random()+r.size,stepSize:Math.random()/30*r.stepsize,step:0,angle:180,opacity:.6*Math.random()+r.opacity,rotation:Math.random()*r.rotation,rotationSpeed:(Math.random()-.5)*r.rotationSpeed,snowflakeMethod:r.snowflakeMethod});p()})()})()},dark:()=>{const e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;let t,n,o,i=.05,s=document.getElementById("universe"),a=s.getContext("2d"),r=!0,l="226,225,224",d=[];function c(){t=window.innerWidth,n=window.innerHeight,o=.216*t,s.setAttribute("width",t),s.setAttribute("height",n)}function h(){a.clearRect(0,0,t,n);for(var e=d.length,o=0;o<e;o++){var i=d[o];i.move(),i.fadeIn(),i.fadeOut(),i.draw()}}function m(){this.reset=function(){this.giant=u(3),this.comet=!this.giant&&!r&&u(10),this.x=f(0,t-10),this.y=f(0,n),this.r=f(1.1,2.6),this.dx=f(i,6*i)+(this.comet+1-1)*i*f(50,120)+.1,this.dy=-f(i,6*i)-(this.comet+1-1)*i*f(50,120),this.fadingOut=null,this.fadingIn=!0,this.opacity=0,this.opacityTresh=f(.2,1-.4*(this.comet+1-1)),this.do=f(5e-4,.002)+.001*(this.comet+1-1)},this.fadeIn=function(){this.fadingIn&&(this.fadingIn=!(this.opacity>this.opacityTresh),this.opacity+=this.do)},this.fadeOut=function(){this.fadingOut&&(this.fadingOut=!(this.opacity<0),this.opacity-=this.do/2,(this.x>t||this.y<0)&&(this.fadingOut=!1,this.reset()))},this.draw=function(){if(a.beginPath(),this.giant)a.fillStyle="rgba(180,184,240,"+this.opacity+")",a.arc(this.x,this.y,2,0,2*Math.PI,!1);else if(this.comet){a.fillStyle="rgba("+l+","+this.opacity+")",a.arc(this.x,this.y,1.5,0,2*Math.PI,!1);for(var e=0;e<30;e++)a.fillStyle="rgba("+l+","+(this.opacity-this.opacity/20*e)+")",a.rect(this.x-this.dx/4*e,this.y-this.dy/4*e-2,2,2),a.fill()}else a.fillStyle="rgba(226,225,142,"+this.opacity+")",a.rect(this.x,this.y,this.r,this.r);a.closePath(),a.fill()},this.move=function(){this.x+=this.dx,this.y+=this.dy,!1===this.fadingOut&&this.reset(),(this.x>t-t/4||this.y<0)&&(this.fadingOut=!0)},setTimeout((function(){r=!1}),50)}function u(e){return Math.floor(1e3*Math.random())+1<10*e}function f(e,t){return Math.random()*(t-e)+e}c();const p=btf.throttle((()=>{c()}),200);function g(){h(),btf.universeId=e(g)}btf.addGlobalListener("resize",window,p,"resizef"),function(){for(let e=0;e<o;e++)d[e]=new m,d[e].reset();h()}(),g();btf.addGlobalListener("visibilitychange",document,(()=>{document.hidden?(window.cancelAnimationFrame(btf.universeId),a.clearRect(0,0,s.width,s.height),btf.universeId=null):btf.universeId||(btf.universeId=e(g))}),"universeVisibilityChange")},checkWidth:()=>{if((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=800){window.cancelAnimationFrame(btf.snowId);const e=document.getElementById("snow");e.getContext("2d").clearRect(0,0,e.width,e.height),btf.snowId=null,window.cancelAnimationFrame(btf.universeId);const t=document.getElementById("universe");t.getContext("2d").clearRect(0,0,t.width,t.height),btf.universeId=null}else"light"===document.documentElement.getAttribute("data-theme")?btf.snowflake():btf.dark()},addGlobalListener:(()=>{window.eventMap=window.eventMap||new Map;return(e,t,n,o,i=!1)=>{(e=>{if(window.eventMap.has(e)){const{event:t,selector:n,callback:o,option:i}=window.eventMap.get(e);n instanceof NodeList?n.forEach((e=>{e.removeEventListener(t,o,i)})):n.removeEventListener(t,o,i),window.eventMap.delete(e)}})(o),t instanceof NodeList?t.forEach((t=>{t.addEventListener(e,n,i)})):t.addEventListener(e,n,i),window.eventMap.set(o,{event:e,selector:t,callback:n,option:i})}})(),currentVersion:"v2.68",universeId:null,snowId:null,map:new Map([["red","rgb(241, 71, 71)"],["orange","rgb(241, 162, 71)"],["yellow","rgb(241, 238, 71)"],["purple","rgb(179, 71, 241)"],["blue","rgb(102, 204, 255)"],["gray","rgb(226, 226, 226)"],["green","rgb(57, 197, 187)"],["whitegray","rgb(241, 241, 241)"],["pink","rgb(237, 112, 155)"],["black","rgb(0, 0, 0)"],["darkblue","rgb(97, 100, 159)"],["heoblue","rgb(66, 90, 239)"]]),FpsMonitor:(()=>{const e=[{max:5,desc:"å¡æˆpptðŸ¤¢",color:"#bd0000"},{max:15,desc:"ç”µç«žçº§å¸§çŽ‡ðŸ˜–",color:"red"},{max:25,desc:"æœ‰ç‚¹éš¾å—ðŸ˜¨",color:"orange"},{max:35,desc:"ä¸å¤ªæµç•…ðŸ™„",color:"#9338e6"},{max:45,desc:"è¿˜ä¸é”™å“¦ðŸ˜",color:"#08b7e4"},{max:1/0,desc:"ååˆ†æµç•…ðŸ¤£",color:"#39c5bb"}],t=[.5,.7,.9,1.2,1.5];return class{constructor(){this.state={frame:0,lastTime:0,lastUpdate:0,fpsHistory:Array(10).fill(60),rafId:null},this.visibilityHandler=this.handleVisibilityChange.bind(this),this.elementVisible=!0,this.intersectionObserver=null}init(){this.dom={container:document.getElementById("fps"),num:document.querySelector("#fps .fps-num"),desc:document.querySelector("#fps .fps-des")},this.validateDOM()&&(this.bindIntersectionObserver(),this.bindEvents(),this.startLoop())}validateDOM(){return!!this.dom.container&&!!this.dom.num&&!!this.dom.desc}bindEvents(){btf.addGlobalListener("visibilitychange",document,this.visibilityHandler,"visibilityHandler")}startLoop(){this.state.rafId=requestAnimationFrame(this.loop.bind(this))}loop(e){const{state:t}=this;if(t.frame++,e>t.lastTime+1e3){const n=e-t.lastTime,o=Math.round(1e3*t.frame/n);t.fpsHistory.push(o),t.fpsHistory.length>10&&t.fpsHistory.shift();const i=this.calculateWeightedFps();e-t.lastUpdate>250&&(this.updateDisplay(i),t.lastUpdate=e),t.frame=0,t.lastTime=e}t.rafId=requestAnimationFrame(this.loop.bind(this))}bindIntersectionObserver(){"IntersectionObserver"in window&&(this.intersectionObserver=new IntersectionObserver((e=>{for(const t of e)t.target===this.dom.container&&(this.elementVisible=t.isIntersecting,this.elementVisible?this.state.rafId||(this.state.lastTime=performance.now(),this.state.frame=0,this.startLoop()):(cancelAnimationFrame(this.state.rafId),this.state.rafId=null))}),{threshold:.1}),this.intersectionObserver.observe(this.dom.container))}calculateWeightedFps(){const e=this.state.fpsHistory.slice(-t.length),n=t.slice(-e.length).reduce(((e,t)=>e+t),0),o=e.reduce(((e,n,o)=>e+n*t[o]),0);return Math.round(o/n)}updateDisplay(t){const n=e.find((e=>t<=e.max));this.dom.num.textContent=`FPSï¼š${t}`,this.dom.desc.textContent=n.desc,this.dom.desc.style.color=n.color}handleVisibilityChange(){this.elementVisible&&(document.hidden?(cancelAnimationFrame(this.state.rafId),this.state.rafId=null):this.state.rafId||(this.state.lastTime=performance.now(),this.state.frame=0,this.startLoop()))}destroy(){cancelAnimationFrame(this.state.rafId),document.removeEventListener("visibilitychange",this.visibilityHandler),this.dom=null,this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null)}}})(),replaceAll:(e,t,n)=>e.split(t).join(n),rmf:{showRightMenu:(e,t=0,n=0)=>{const o=document.getElementById("rightMenu");o.style.top=`${t}px`,o.style.left=`${n}px`,o.style.display=e?"block":"none"},copyToClipboard:e=>{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("Copy"),document.body.removeChild(t)},copyWordsLink:()=>btf.rmf.copyToClipboard(window.location.href),switchReadMode:()=>{const e=document.body;e.classList.add("read-mode");const t=document.createElement("button");t.type="button",t.className="fas fa-sign-out-alt exit-readmode",e.appendChild(t),t.addEventListener("click",(()=>{e.classList.remove("read-mode"),t.remove()}))},copySelect:()=>{document.execCommand("Copy")},scrollToTop:()=>{btf.scrollToDest(0,500)},rightMenuCommentText:e=>{const t=document.getElementById("post-comment").offsetTop;window.scrollTo(0,t-80),"undefined"!==e&&"null"!==e||(e="å¥½æ£’ï¼");const n=()=>{setTimeout((()=>{const t=document.querySelector(".el-textarea__inner");t||n();const o=document.createEvent("HTMLEvents");o.initEvent("input",!0,!0);const i=btf.replaceAll(e,"\n","\n> ");t.value=`> ${i}\n\n`,t.dispatchEvent(o),t.focus(),t.setSelectionRange(-1,-1);const s=document.getElementById("comment-tips");s&&s.classList.add("show")}),100)};n()},fullScreen:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}},switchComments:(e=document,t)=>{const n=e.querySelector("#switch-btn");if(!n)return;let o=!1;const i=e.querySelector("#post-comment");btf.addEventListenerPjax(n,"click",(()=>{i.classList.toggle("move"),o||"function"!=typeof loadOtherComment||(o=!0,loadOtherComment(e,t))}),"handleSwitchBtn")}};window.btf={...window.btf,...e},Object.assign(window.btf,{currentVersion:e.currentVersion,universeId:e.universeId,snowId:e.snowId,map:e.map})})();