document.addEventListener("DOMContentLoaded",(function(){const e={formatDateTime:e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},umiToken:"fM7+vUSp/wpEp/mp0LxXrjS46tMQWimFhssZdUuj2SADnmGfHo5rZMOh4PpYSumeLcUNt4a2+q0TNW6VH5vymKH3YFxPNxOm28yjdAAHD/Tew66V/8Ad/K9dXxULUuMWaSL2hUS2zTGIZWipOYUHzkjRFwShDAYQwfbgOGrmgW/P36qqr9FaZaKt9LYVkbY9hQKQ4tRTlhc8zFgwIn/q3Rw/ot7G0HVprAk3PwBkEdyDfPQd7kchi/f+g1g+1X856/v0O7GirvBeQQ7TPhi4/H0/kNm+ZABPDk6+VomlMNnYdZi1KiW90SfTOcUDlvObyKUbCsQpl/LMiDeAtby+0pzkqaSLSpsr7Y5eoR4pDP4Wt+RaZkkHjawJfYjc",fetchUmami:async(e,t,n)=>{try{if(!e||!t||!n)throw new Error("å‚æ•° startAtã€endAt æˆ– umiToken ä¸å®Œæ•´");const a=new URL("https://umami.aimiliy.top/api/websites/3348d0ad-813b-4d17-98d2-d5404445f786/stats");a.searchParams.append("startAt",e.getTime()),a.searchParams.append("endAt",t.getTime());const o=await fetch(a.toString(),{method:"GET",cache:"default",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!o.ok)throw new Error(`è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š${o.status} ${o.statusText}`);return await o.json()}catch(e){throw console.error("è·å– umami ç»Ÿè®¡æ•°æ®å¤±è´¥ï¼š",e.message),e}},removeAllHtmlTags:e=>`â€œ${e.replace(/<[^>]+>.*?<\/[^>]+>|<[^>]+\/>|<[^>]+>/gis,"").trim()}â€`,removeAllHtmlTagsNoMark:e=>`${e.replace(/<[^>]+>.*?<\/[^>]+>|<[^>]+\/>|<[^>]+>/gis,"").trim()}`,contentFormat:e=>{let t=e.match(/(http(.*).[jpg|png|gif])/g);e=(e=e.replace(/<img(.*?)src=[\"|\']?(.*?)[\"|\']?(.*?)>|!\[(.*?)\]\((.*?)\)/g,"")).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");let n="<br>";t&&t.forEach((e=>{n+='<a href="'+e+'" target="_blank" data-fancybox="group" class="fancybox"><img src="'+e+'" style="max-width: 100%; object-fit: cover; border-radius: 10px;margin-top: 10px"></a>'}));const a=[...(e+=n).matchAll(/<video.*?src=["'](.*?)["'].*?>.*?<\/video>/gi)];return a.length>0&&a.forEach((t=>{const a=t[1];let o="";o=a.includes("bilibili.com")?`\n                          <div style="position: relative; padding: 30% 45%; margin-top: 10px; margin-bottom: 10px;">\n                            <iframe\n                              style="position: absolute; width: 100%; height: 100%; left: 0; top: 0; margin: 0;\n                              border-radius: 12px;"\n                              src="${a}" scrolling="no" frameborder="no" allowfullscreen="true">\n                            </iframe>\n                          </div>`:`\n                          <a class="bber-content-video" href="${a}" data-fancybox="gallery" data-caption="">\n                            <video src="${a}" controls style="max-width: 100%; border-radius: 10px; margin-top: 10px;"></video>\n                          </a>`,n+=o,e=e.replace(t[0],"")})),e.replace(/(<br\s*\/?>)+$/,"")},removeScrollReveal:()=>{document.querySelectorAll("[data-sr-id]").forEach((e=>{e.removeAttribute("data-sr-id"),e.style.removeProperty("visibility"),e.style.removeProperty("opacity"),e.style.removeProperty("transform"),e.style.removeProperty("transition")})),document.documentElement.classList.remove("sr")}},t=(()=>{const e=e=>e*Math.PI/180,t=(t,n=!1)=>{const a=document.getElementById("welcome-info");if(n)a.innerHTML='\n                    <div style="text-align: center;"><b>ğŸ‰ æ¬¢è¿ä¿¡æ¯ ğŸ‰</b></div>\n                    <b>\n                        <span style="padding:10px;display: flex;justify-content: center;align-items: center;">\n                            &emsp;&emsp;æ‚¨å½“å‰çš„ç½‘ç»œè¾ƒæ…¢ï¼Œæ­£åœ¨åŠ é€Ÿè·å–æ‚¨çš„ä½ç½®ä¿¡æ¯ï¼\n                        </span>\n                    </b>';else try{const{ad_info:n,location:o,ip:s}=t.result,{nation:r,province:i,city:l,district:c}=n,d=i?`${i} ${l} ${c}`:r,u=((t,n,a,o)=>{const s=e(o-n),r=e(a-t),i=Math.sin(s/2)**2+Math.cos(e(n))*Math.cos(e(o))*Math.sin(r/2)**2,l=2*Math.asin(Math.sqrt(i));return Math.round(6371*l)})(114.34253,30.49984,o.lng,o.lat),m=((e,t,n)=>{const a={"æ—¥æœ¬":"ã‚ˆã‚ã—ãï¼Œä¸€èµ·å»çœ‹æ¨±èŠ±å—","ç¾å›½":"Let us live in peace!","è‹±å›½":"æƒ³åŒä½ ä¸€èµ·å¤œä¹˜ä¼¦æ•¦çœ¼","ä¿„ç½—æ–¯":"å¹²äº†è¿™ç“¶ä¼ç‰¹åŠ ï¼","æ³•å›½":"C'est La Vie","å¾·å›½":"Die Zeit verging im Fluge.","æ¾³å¤§åˆ©äºš":"ä¸€èµ·å»å¤§å ¡ç¤å§ï¼","åŠ æ‹¿å¤§":"æ‹¾èµ·ä¸€ç‰‡æ«å¶èµ äºˆä½ ","ä¸­å›½":{"åŒ—äº¬å¸‚":"åŒ—â€”â€”äº¬â€”â€”æ¬¢è¿ä½ ~~~","å¤©æ´¥å¸‚":"è®²æ®µç›¸å£°å§ã€‚","æ²³åŒ—çœ":"å±±åŠ¿å·å·æˆå£å’ï¼Œå¤©ä¸‹é›„å…³...","å±±è¥¿çœ":"å±•å¼€åå…·é•¿ä¸‰å°ºï¼Œå·²å å±±æ²³äº”ç™¾ä½™ã€‚","å†…è’™å¤è‡ªæ²»åŒº":"å¤©è‹è‹ï¼Œé‡èŒ«èŒ«ï¼Œé£å¹è‰ä½è§ç‰›ç¾Šã€‚","è¾½å®çœ":"æˆ‘æƒ³åƒçƒ¤é¸¡æ¶ï¼","å‰æ—çœ":"çŠ¶å…ƒé˜å°±æ˜¯ä¸œåŒ—çƒ§çƒ¤ä¹‹ç‹ã€‚","é»‘é¾™æ±Ÿçœ":"å¾ˆå–œæ¬¢å“ˆå°”æ»¨å¤§å‰§é™¢ã€‚","ä¸Šæµ·å¸‚":"ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­å›½åªæœ‰ä¸¤ä¸ªåŸå¸‚ã€‚","æ±Ÿè‹çœ":{"å—äº¬å¸‚":"è¿™æ˜¯æˆ‘æŒºæƒ³å»çš„åŸå¸‚å•¦ã€‚","è‹å·å¸‚":"ä¸Šæœ‰å¤©å ‚ï¼Œä¸‹æœ‰è‹æ­ã€‚",default:"æ•£è£…æ˜¯å¿…é¡»è¦æ•£è£…çš„ã€‚"},"æµ™æ±Ÿçœ":"ä¸œé£æ¸ç»¿è¥¿æ¹–æŸ³ï¼Œé›å·²è¿˜äººæœªå—å½’ã€‚","æ²³å—çœ":{"éƒ‘å·å¸‚":"è±«å·ä¹‹åŸŸï¼Œå¤©åœ°ä¹‹ä¸­ã€‚","å—é˜³å¸‚":"è‡£æœ¬å¸ƒè¡£ï¼Œèº¬è€•äºå—é˜³ã€‚æ­¤å—é˜³éå½¼å—é˜³ï¼","é©»é©¬åº—å¸‚":"å³°å³°æœ‰å¥‡çŸ³ï¼ŒçŸ³çŸ³æŒŸä»™æ°”ã€‚åµ–å²ˆå±±çš„èŠ±å¾ˆç¾å“¦ï¼",default:"å¯å¦å¸¦æˆ‘å“å°æ²³å—çƒ©é¢å•¦ï¼Ÿ"},"å®‰å¾½çœ":"èšŒåŸ ä½äº†ï¼ŒèŠœæ¹–èµ·é£ã€‚","ç¦å»ºçœ":"äº•é‚‘ç™½äº‘é—´ï¼Œå²©åŸè¿œå¸¦å±±ã€‚","æ±Ÿè¥¿çœ":"è½éœä¸å­¤é¹œé½é£ï¼Œç§‹æ°´å…±é•¿å¤©ä¸€è‰²ã€‚","å±±ä¸œçœ":"é¥æœ›é½å·ä¹ç‚¹çƒŸï¼Œä¸€æ³“æµ·æ°´æ¯ä¸­æ³»ã€‚","æ¹–åŒ—çœ":"æ¥ç¢—çƒ­å¹²é¢ï¼","æ¹–å—çœ":"74751ï¼Œé•¿æ²™æ–¯å¡”å…‹ã€‚","å¹¿ä¸œçœ":"è€æ¿æ¥ä¸¤æ–¤ç¦å»ºäººã€‚","å¹¿è¥¿å£®æ—è‡ªæ²»åŒº":"æ¡‚æ—å±±æ°´ç”²å¤©ä¸‹ã€‚","æµ·å—çœ":"æœè§‚æ—¥å‡ºé€ç™½æµªï¼Œå¤•çœ‹äº‘èµ·æ”¶éœå…‰ã€‚","å››å·çœ":"åº·åº·å·å¦¹å­ã€‚","è´µå·çœ":"èŒ…å°ï¼Œå­¦ç”Ÿï¼Œå†å¡200ã€‚","äº‘å—çœ":"ç‰é¾™é£èˆäº‘ç¼ ç»•ï¼Œä¸‡ä»å†°å·ç›´è€¸å¤©ã€‚","è¥¿è—è‡ªæ²»åŒº":"èººåœ¨èŒ«èŒ«è‰åŸä¸Šï¼Œä»°æœ›è“å¤©ã€‚","é™•è¥¿çœ":"æ¥ä»½è‡Šå­é¢åŠ é¦ã€‚","ç”˜è‚ƒçœ":"ç¾Œç¬›ä½•é¡»æ€¨æ¨æŸ³ï¼Œæ˜¥é£ä¸åº¦ç‰é—¨å…³ã€‚","é’æµ·çœ":"ç‰›è‚‰å¹²å’Œè€é…¸å¥¶éƒ½å¥½å¥½åƒã€‚","å®å¤å›æ—è‡ªæ²»åŒº":"å¤§æ¼ å­¤çƒŸç›´ï¼Œé•¿æ²³è½æ—¥åœ†ã€‚","æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº":"é©¼é“ƒå¤é“ä¸ç»¸è·¯ï¼Œèƒ¡é©¬çŠ¹é—»å”æ±‰é£ã€‚","å°æ¹¾çœ":"æˆ‘åœ¨è¿™å¤´ï¼Œå¤§é™†åœ¨é‚£å¤´ã€‚","é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº":"æ°¸å®šè´¼æœ‰æ®‹ç•™åœ°é¬¼åšï¼Œè¿å‡»å…‰éå²ç‰ã€‚","æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº":"æ€§æ„Ÿè·å®˜ï¼Œåœ¨çº¿å‘ç‰Œã€‚",default:"å¸¦æˆ‘å»ä½ çš„åŸå¸‚é€›é€›å§ï¼"},default:"å¸¦æˆ‘å»ä½ çš„å›½å®¶é€›é€›å§ã€‚"};return"ä¸­å›½"===e&&a[e]&&a[e][t]?"object"==typeof a[e][t]?a[e][t][n]?a[e][t][n]:a[e][t].default||"å’¦ï¼Œè¿™é‡Œå¥½åƒè¿˜æ²¡è¢«å°ç²¾çµæ ‡æ³¨å“ï¼":a[e][t]:a[e]?a[e]:a.default})(r,i,l),p=(()=>{const e=(new Date).getHours();return e>=5&&e<11?"<span>æ—©ä¸Šå¥½</span>ï¼Œä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡å‘€ï¼":e>=11&&e<13?"<span>ä¸­åˆå¥½</span>ï¼Œå…ˆæ”¾ä¸‹å·¥ä½œåƒé¡¿å¥½çš„å§ï½":e>=13&&e<15?"<span>ä¸‹åˆå¥½</span>ï¼Œå°æ†©ä¸€ä¼šå„¿ï¼Œåˆ«å¤ªç´¯äº†å“¦ã€‚":e>=15&&e<16?"<span>èŒ¶ç‚¹æ—¶é—´</span>åˆ°å•¦ï¼æ¥æ¯å¥¶èŒ¶ææç¥ï½":e>=16&&e<19?"<span>å‚æ™šå¥½</span>ï¼Œå¤•é˜³æ­£ç¾ï¼Œè®°å¾—ä¼‘æ¯çœ¼ç›ã€‚":e>=19&&e<24?"<span>æ™šä¸Šå¥½</span>ï¼Œä»Šå¤©ä¹Ÿè¾›è‹¦å•¦ï¼Œæ”¾æ¾ä¸€ä¸‹å§ï½":"<span>å¤œæ·±äº†</span>ï¼Œæ—©ç‚¹ä¼‘æ¯ï¼Œåˆ«å†åˆ·æ‰‹æœºå•¦ï½"})();a.innerHTML=`\n                    <div style="text-align: center;"><b>ğŸ‰ æ¬¢è¿ä¿¡æ¯ ğŸ‰</b></div>\n                    <b>&emsp;&emsp;æ¬¢è¿æ¥è‡ª \n                        <span style="color:var(--theme-color)">${d}</span> çš„å°ä¼™ä¼´ï¼Œ${p}\n                        æ‚¨ç°åœ¨è·ç¦»ç«™é•¿çº¦ \n                        <span style="color:var(--theme-color)">${u}</span> å…¬é‡Œï¼Œ\n                        å½“å‰çš„IPåœ°å€ä¸ºï¼š \n                        <span class="blur-ip">${s}</span>ï¼Œ \n                        ${m}\n                    </b>`}catch(e){console.error("åœ°ç†ä½ç½®ä¿¡æ¯åŠ è½½å¤±è´¥ï¼š",e),a.innerHTML='<div style="text-align: center;"><b>ğŸ‰ æ¬¢è¿ä¿¡æ¯ ğŸ‰</b></div>\n                    <b>\n                        <span style="padding:10px;display: flex;justify-content: center;align-items: center;">\n                            &emsp;&emsp;åœ°ç†ä½ç½®ä¿¡æ¯åŠ è½½å¤±è´¥\n                        </span>\n                    </b>'}};return{init:async()=>{if(!/^\/(?:page\/\d+\/|)$/.test(window.location.pathname))return;const e=(()=>{const e=localStorage.getItem("ipLocation");if(!e)return null;try{const t=JSON.parse(e),n=t.locationTime,a=Date.now();if(n&&a-n<18e5)return t}catch(e){console.warn("ç¼“å­˜è§£æå¤±è´¥",e)}return null})();if(e)t(e);else{t(null,!0);try{const e=await new Promise(((e,t)=>{const n="jsonp_callback_"+Date.now(),a=setTimeout((()=>{t(new Error("è¯·æ±‚è¶…æ—¶")),o()}),8e3);function o(){delete window[n],s.remove(),clearTimeout(a)}window[n]=t=>{e(t),o()};const s=document.createElement("script");s.src=`https://apis.map.qq.com/ws/location/v1/ip?key=UEVBZ-KBWCW-L67R2-YZ7NC-CYZY3-LKFR5&output=jsonp&callback=${n}`,s.onerror=e=>{t(e),o()},document.head.appendChild(s)}));(e=>{const t={result:{ad_info:e.result.ad_info,location:e.result.location,ip:e.result.ip},locationTime:Date.now()};localStorage.setItem("ipLocation",JSON.stringify(t))})(e),t(e)}catch(e){console.error("Location fetch failed:",e),$welcomeInfo.innerHTML='<div style="text-align: center;"><b>ğŸ‰ æ¬¢è¿ä¿¡æ¯ ğŸ‰</b></div>\n                        <b>\n                            <span style="padding:10px;display: flex;justify-content: center;align-items: center;">\n                                &emsp;&emsp;åœ°ç†ä½ç½®ä¿¡æ¯åŠ è½½å¤±è´¥\n                            </span>\n                        </b>'}}}}})(),n=(()=>{const e=(e,t)=>{if(t.has(e))return t.get(e);const n=e.match(/rgb\((\d+), (\d+), (\d+)\)/);if(!n)throw new Error("Invalid RGB string format");const[a,o,s,r]=n,i=`#${Math.min(parseInt(o,10)+40,255).toString(16).padStart(2,"0")}${Math.min(parseInt(s,10)+40,255).toString(16).padStart(2,"0")}${Math.min(parseInt(r,10)+40,255).toString(16).padStart(2,"0")}`;return t.set(e,i),i};return{init:()=>{const t={defaultMusic:{id:"7397995017",type:"playlist",server:"tencent"},canvas:document.getElementById("visualizer"),visualizer:{fftSize:256,smoothing:.9,shadowBlur:15},cache:new Map},n={canvas:t.canvas,ctx:t.canvas.getContext("2d"),anMusicBg:document.getElementById("an_music_bg"),anMusicPage:document.getElementById("anMusic-page"),page:document.getElementById("page"),menuMask:document.getElementById("menu-mask"),anMusicPageMeting:document.getElementById("anMusic-page-meting")};let a,o,s,r,i,l,c,d,u=.8,m=null,p=null,g=null;const h=(e=!0)=>{const t=e=>{if(!e)return;n.anMusicBg.style.backgroundImage=e.style.backgroundImage;let t=e.querySelector("div.child");t||(t=document.createElement("div"),t.classList.add("child"),e.appendChild(t)),t.style.backgroundImage=e.style.backgroundImage};if(e){const e=n.anMusicPage.querySelector(".aplayer-pic");t(e)}else{n.page.classList.add("music-loader-shadow"),btf.setMusicLoading.add(n.anMusicPage);const e=new MutationObserver((()=>{const a=n.anMusicPage.querySelector(".aplayer-pic");a&&(btf.setMusicLoading.remove(n.anMusicPage),n.page.classList.remove("music-loader-shadow"),document.body.style.background="rgb(13, 13, 13)",e.disconnect(),t(a),y())}));e.observe(document.body,{childList:!0,subtree:!0})}},f=()=>{s.getByteFrequencyData(d),n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height);const a=btf.map.get(localStorage.getItem("themeColor"));if(a!==g){g=a;const o=e(a,t.cache);p=n.ctx.createLinearGradient(0,0,0,n.canvas.height),p.addColorStop(0,a),n.ctx.shadowBlur=t.visualizer.shadowBlur,n.ctx.shadowColor=o,n.ctx.fillStyle=p}const o=2*c,r=o-1,i=(n.canvas.width-1*r-1)/o,u=n.canvas.width/2,m=n.canvas.height;for(let e=0;e<c;e++){const t=.5*d[e],a=i*(1-t/m),o=u-.5-e*(i+1)-i,s=u+.5+e*(i+1);n.ctx.beginPath(),n.ctx.moveTo(o,m),n.ctx.lineTo(o+i,m),n.ctx.lineTo(o+i-a/2,m-t),n.ctx.lineTo(o+a/2,m-t),n.ctx.closePath(),n.ctx.fill(),n.ctx.beginPath(),n.ctx.moveTo(s,m),n.ctx.lineTo(s+i,m),n.ctx.lineTo(s+i-a/2,m-t),n.ctx.lineTo(s+a/2,m-t),n.ctx.closePath(),n.ctx.fill()}l=requestAnimationFrame(f)},y=()=>{const e=n.anMusicPage.querySelector("meting-js")?.aplayer;if(!e)return;e.volume(u,!0),e.on("loadeddata",(()=>h(!0))),n.canvas.width=Math.min(.95*window.innerWidth,1500);const t=n.anMusicPage.querySelector(".aplayer-pic"),a=t.querySelector(".child")||(()=>{const e=document.createElement("div");return e.className="child",t.appendChild(e),e})();e.on("play",(()=>{var n;t.classList.add("turn-around"),a.style.animationPlayState="running","suspended"===o?.state&&o.resume(),n=e.audio,i||(i=n,r=o.createMediaElementSource(i),r.connect(s),s.connect(o.destination)),f();const l=e.list.audios[e.list.index];"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:l.name,artist:l.artist,album:l.artist,artwork:[{src:l.cover||""}]}))})),e.on("pause",(()=>{t.classList.remove("turn-around"),a.style.animationPlayState="paused",setTimeout((()=>{cancelAnimationFrame(l),n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height)}),1e3)})),(e=>{const t=btf.debounce((t=>{switch(t.code){case"Space":t.preventDefault(),e.toggle();break;case"ArrowRight":t.preventDefault(),e.skipForward();break;case"ArrowLeft":t.preventDefault(),e.skipBack();break;case"ArrowUp":u=Math.min(u+.1,1),e.volume(u,!0);break;case"ArrowDown":u=Math.max(u-.1,0),e.volume(u,!0)}}),200);btf.addEventListenerPjax("click",n.anMusicPage,(t=>{const{target:n}=t;n.closest("#anMusicBtnGetSong")?btf.throttle(S,300)(e):n.closest("#anMusicRefreshBtn")?btf.throttle(M,300)():n.closest("#anMusicSwitching")&&btf.throttle(x,300)()})),btf.addEventListenerPjax("keydown",document,t),btf.addEventListenerPjax("resize",window,btf.throttle((()=>{n.canvas.width=Math.min(.95*window.innerWidth,1500)}),100))})(e);btf.addGlobalFn("pjaxSendOnce",(()=>{document.querySelectorAll("meting-js").forEach((e=>{try{e.lock=!0,e.aplayer?.pause?.(),e.aplayer?.events?.events&&Object.keys(e.aplayer.events.events).forEach((t=>{e.aplayer.events.events[t]=[]})),setTimeout((()=>{try{e.aplayer?.destroy?.(),e.aplayer=null,e.innerHTML=""}catch(e){console.warn("[MetingJS] å»¶è¿Ÿé”€æ¯å¤±è´¥:",e)}}),150)}catch(e){console.warn("[MetingJS] é”€æ¯å¤±è´¥:",e)}}))}),"destroyMetingAPlayer"),btf.addGlobalFn("pjaxSendOnce",(()=>{cancelAnimationFrame(l),n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height)}),"musicCanvasDestroy")},v=e=>{for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e},b=e=>`https://meting-js.miraii.cn/api?server=${e.server}&type=${e.type}&id=${e.id}&r=${Math.random()*Date.now()}`,w=async e=>{try{const t=await fetch(e);return t.ok?await t.json():[]}catch(e){return console.error("Fetch songs error:",e),[]}},S=e=>{const t=e.list.audios;if(!t?.length)return;let n=[];try{n=JSON.parse(localStorage.getItem("shuffledPlaylist")||"[]")}catch{}(!n.length||n.length>=t.length)&&(n=v([...Array(t.length).keys()]));const a=n.shift();localStorage.setItem("shuffledPlaylist",JSON.stringify(n)),e.list.switch(a),e.play()},M=async()=>{const e=n.anMusicPage.querySelector("meting-js")?.aplayer;if(!e)return;e.pause(),a=t.defaultMusic,localStorage.setItem("localMusic",JSON.stringify(t.defaultMusic));const o=await w(b(a));o.length&&(e.list.clear(),e.list.add(o))},x=async()=>{const e=n.anMusicPage.querySelector("meting-js")?.aplayer;if(!e)return;e.pause(),localStorage.removeItem("shuffledPlaylist");let o=[];try{o=JSON.parse(localStorage.getItem("shuffledMusicList")||"[]")}catch{}(!o.length||o.length>=m.length)&&(o=v([...Array(m.length).keys()]));let s=o.shift();for(;m[s]?.id===a.id&&o.length;)s=o.shift();localStorage.setItem("shuffledMusicList",JSON.stringify(o)),a=m[s]||t.defaultMusic,localStorage.setItem("localMusic",JSON.stringify(a));const r=await w(b(a));r.length&&(e.list.clear(),e.list.add(r))};n.anMusicPageMeting.innerHTML='<meting-js id="7397995017" server="tencent" type="playlist" mutex="true" preload="auto" theme="var(--theme-color)" order="list" list-max-height="320px"></meting-js>',(()=>{try{a=JSON.parse(localStorage.getItem("localMusic"))||t.defaultMusic}catch{a=t.defaultMusic,localStorage.removeItem("localMusic")}localStorage.setItem("defaultMusic",JSON.stringify(t.defaultMusic)),localStorage.setItem("localMusic",JSON.stringify(a))})(),(()=>{o=new(window.AudioContext||window.webkitAudioContext),s=o.createAnalyser(),s.fftSize=t.visualizer.fftSize,s.smoothingTimeConstant=t.visualizer.smoothing,c=s.frequencyBinCount,d=new Uint8Array(c);btf.addGlobalFn("pjaxSendOnce",(()=>{o&&(o.close().catch(console.error),o=null,s=null,r=null,i=null)}),"audioContextDestroy")})(),Promise.all([(async()=>{if(!m)try{const e=await fetch("https://cdn.aimiliy.top/npm/json/musicListCache.json");m=e.ok?await e.json():[t.defaultMusic]}catch(e){m=[t.defaultMusic],console.log("Fetch remote musicList error:",e)}})(),new Promise((e=>setTimeout(e,0)))]).then((()=>{h(!1)}))}}})(),a=(()=>{let e=null,t=!1,n=null;const a=()=>{if(e)return;e=new Swiper(".blog-slider",{passiveListeners:!0,spaceBetween:30,effect:"fade",autoplay:!1,loop:!0,delay:5e3,disableOnInteraction:!0,mousewheel:!0,pagination:{el:".blog-slider__pagination",clickable:!0}});const a=document.getElementById("swiper_container");a&&((t=>{n=new IntersectionObserver((t=>{t.forEach((t=>{e&&(t.isIntersecting?btf.runIdle((()=>e.autoplay.start()),800):e.autoplay.stop())}))}),{threshold:.5}),n.observe(t),btf.addEventListenerPjax("mouseenter",t,(()=>{e&&e.autoplay.stop()})),btf.addEventListenerPjax("mouseleave",t,(()=>{btf.runIdle((()=>e&&e.autoplay.start()),1e3)}))})(a),btf.addGlobalFn("pjaxSendOnce",(()=>{e&&(e.destroy(!0,!0),e=null),t=!1,n&&(n.disconnect(),n=null)}),"swiperModuleDestroy"))};return{init:()=>{if(n&&(n.disconnect(),n=null),e&&(e.destroy(!0,!0),e=null),t)return;const o=document.getElementById("swiper_container");if(!o)return;new IntersectionObserver(((e,n)=>{e.forEach((e=>{e.isIntersecting&&(n.disconnect(),t=!0,btf.runIdle(a,300))}))}),{rootMargin:"80px 0px",threshold:.1}).observe(o)}}})(),o=(()=>{let t=null,n=0,a=0,o=null;let s=null;const r="bbTalkCache",i=()=>{t||(t=setInterval(c,4e3))},l=()=>{t&&(clearInterval(t),t=null)},c=()=>{o&&(n++,o.style.transition="transform 0.5s ease-in-out",o.style.transform=`translateY(${32*-n}px)`,n===a&&setTimeout((()=>{o.style.transition="none",o.style.transform="translateY(0)",n=0}),510))};return{init:async()=>{s&&(s.disconnect(),s=null),l(),n=0,a=0,o=null;const t=document.getElementById("bb-talk");if(!t)return;t.replaceChildren();let c=(()=>{try{const e=localStorage.getItem(r);if(!e)return null;const t=JSON.parse(e);if(Date.now()-t.timestamp<36e5)return t.data}catch(e){console.warn("ç¼“å­˜è¯»å–å¤±è´¥:",e)}return null})();if(!c)try{const t=await fetch("https://linghua.aimiliy.top/api/bb/list?page=1&size=6");if(!t.ok)throw new Error("ç½‘ç»œé”™è¯¯: "+t.status);c=(await t.json()).data.items.map((t=>e.removeAllHtmlTagsNoMark(e.contentFormat(t.content)))),(e=>{try{const t={timestamp:Date.now(),data:e};localStorage.setItem(r,JSON.stringify(t))}catch(e){console.warn("ç¼“å­˜å†™å…¥å¤±è´¥:",e)}})(c)}catch(e){console.error("è·å–æ•°æ®å¤±è´¥:",e),c=["<b>åŠ è½½å¤±è´¥</b>ï¼Œè¯·ç¨åå†è¯•~"]}var d;o=document.createElement("div"),o.className="bb-track",o.style.willChange="transform",((e,t)=>{const n=document.createDocumentFragment();e.forEach((e=>{const t=document.createElement("div");t.className="bb-item",t.innerHTML=e,n.appendChild(t)}));const a=n.firstChild?.cloneNode(!0);a&&n.appendChild(a),t.appendChild(n)})(c,o),t.appendChild(o),a=c.length,d=t,s&&s.disconnect(),s=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?btf.runIdle(i,400):l()}))}),{threshold:.5}),s.observe(d),btf.addGlobalFn("pjaxSendOnce",(()=>{l(),s&&(s.disconnect(),s=null);const e=document.getElementById("bb-talk");e?.replaceChildren()}),"bbTalkElDestroy")}}})(),s=(()=>{let e=null,t=new Set;return{init:(n=".wow")=>{const a=document.querySelectorAll(n),o=(e||(e=new IntersectionObserver((n=>{n.forEach((n=>{const a=n.target;n.isIntersecting&&!a.dataset.revealed&&(a.dataset.revealed="true",setTimeout((()=>{a.classList.add("in-view"),e.unobserve(a),t.delete(a)}),200))}))}),{threshold:.1,rootMargin:"50px 0px"})),e);a.forEach((e=>{t.has(e)||(o.observe(e),t.add(e))})),btf.addGlobalFn("pjaxSendOnce",(()=>{e&&(e.disconnect(),e=null,t.clear())}))}}})(),r=[{path:"/personal/about/",modules:[{init:async()=>{await(async()=>{const t="fM7+vUSp/wpEp/mp0LxXrjS46tMQWimFhssZdUuj2SADnmGfHo5rZMOh4PpYSumeLcUNt4a2+q0TNW6VH5vymKH3YFxPNxOm28yjdAAHD/Tew66V/8Ad/K9dXxULUuMWaSL2hUS2zTGIZWipOYUHzkjRFwShDAYQwfbgOGrmgW/P36qqr9FaZaKt9LYVkbY9hQKQ4tRTlhc8zFgwIn/q3Rw/ot7G0HVprAk3PwBkEdyDfPQd7kchi/f+g1g+1X856/v0O7GirvBeQQ7TPhi4/H0/kNm+ZABPDk6+VomlMNnYdZi1KiW90SfTOcUDlvObyKUbCsQpl/LMiDeAtby+0pzkqaSLSpsr7Y5eoR4pDP4Wt+RaZkkHjawJfYjc",n=new Date,a=new Date(n.setHours(0,0,0,0)),o=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1),s=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1,23,59,59,999),r=new Date(n.getFullYear(),n.getMonth(),1),i=new Date(2024,1,1);i.setHours(0,0,0,0);try{const[n,l,c,d]=await Promise.all([e.fetchUmami(o,s,t),e.fetchUmami(a,new Date,t),e.fetchUmami(r,new Date,t),e.fetchUmami(i,new Date,t)]),u=["æœ€è¿‘æ´»è·ƒ","ä»Šæ—¥äººæ•°","ä»Šæ—¥è®¿é—®","æ˜¨æ—¥äººæ•°","æ˜¨æ—¥è®¿é—®","æœ¬æœˆè®¿é—®","æ€»è®¿é—®é‡"],m=[null,l.visitors?.value||0,l.pageviews?.value||0,n.visitors?.value||0,n.pageviews?.value||0,c.pageviews?.value||0,d.pageviews?.value||0];let p=document.getElementById("statistic");if(!p)return void console.log("Domå…ƒç´ ä¸å­˜åœ¨");let g=[];for(let e=0;e<m.length;e++)0!==e&&(p.innerHTML+=`<div><span>${u[e]}</span><span id="${u[e]}">${m[e]}</span></div>`,queueMicrotask((()=>{g.push(new CountUp(u[e],0,m[e],0,2,{useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""}))})));let h=document.querySelector(".about-statistic.author-content-item");h&&new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){for(let e=0;e<m.length;e++)0!==e&&queueMicrotask((()=>{g[e-1].start()}));t.disconnect()}}))}),{root:null,rootMargin:"0px",threshold:0}).observe(h)}catch(e){console.log("è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥ï¼š",e)}let l=null;l=setInterval((function(){const e=document.querySelector("span[data-show]"),t=e.nextElementSibling||document.querySelector(".first-tips"),n=document.querySelector("span[data-up]");n&&n.removeAttribute("data-up"),e.removeAttribute("data-show"),e.setAttribute("data-up",""),t.setAttribute("data-show","")}),2e3),document.addEventListener("pjax:send",(function(){l&&clearInterval(l)}))})()}}]},{path:"/personal/bb/",modules:[{init:()=>{let t=0,n=0,a=[],o=1;const s=document.getElementById("more"),r=document.getElementById("bb_loading");let i=document.getElementById("bb-main");const l=new Masonry(i,{itemSelector:".bb-card",columnWidth:".bb-card",gutter:10,percentPosition:!0});let c=!1;const d=async()=>{if(!c){c=!0,s.style.display="none",r.style.display="block";try{const e=await fetch(`https://linghua.aimiliy.top/api/bb/list?page=${o}&size=12`);if(!e.ok)throw new Error("ç½‘ç»œé”™è¯¯: "+e.status);const s=await e.json();t=s.data.total,a=s.data.items,n+=a.length,1===o&&(document.querySelector(".bb-info").innerHTML=`\n                                <svg style="width:1.20em;height:1.20em;top:5px;fill:currentColor;overflow:hidden;position:relative">\n                                    <use xlink:href="#icon-chat"></use>\n                                </svg> ç«™é•¿çš„æ—¥å¸¸åˆ†äº«(${t})\n                            `),o+=1,await u()}catch(e){console.error("è·å–æ•°æ®å¤±è´¥:",e),btf.$notify("åŠ è½½å¤±è´¥","å½“å‰ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•","error",3e3)}finally{r.style.display="none",n<t&&(s.style.display="block"),c=!1}}},u=()=>new Promise((o=>{let c=0;setTimeout((()=>{r.style.display="none"}),300);const d=()=>{if(c>=a.length)return n<t&&(s.style.display="block"),void o();const r=a[c],u=e.formatDateTime(r.createdAt);r.content=e.contentFormat(r.content);const m=e.removeAllHtmlTags(r.content),p=document.createElement("div");p.className="bb-card",p.style.opacity="0",p.style.transform="translateY(20px)",p.innerHTML=`\n                                    <div class="card-header">\n                                        <div class="avatar">\n                                            <img class="nofancybox" src="${r.author.avatar}">\n                                        </div>\n                                        <div class="bb-info-avatar">\n                                            <span><div class="name">${r.author.nickName}</div><svg  viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" class="is-badge"><path  d="m512 268c0 17.9-4.3 34.5-12.9 49.7s-20.1 27.1-34.6 35.4c.4 2.7.6 6.9.6 12.6 0 27.1-9.1 50.1-27.1 69.1-18.1 19.1-39.9 28.6-65.4 28.6-11.4 0-22.3-2.1-32.6-6.3-8 16.4-19.5 29.6-34.6 39.7-15 10.2-31.5 15.2-49.4 15.2-18.3 0-34.9-4.9-49.7-14.9-14.9-9.9-26.3-23.2-34.3-40-10.3 4.2-21.1 6.3-32.6 6.3-25.5 0-47.4-9.5-65.7-28.6-18.3-19-27.4-42.1-27.4-69.1 0-3 .4-7.2 1.1-12.6-14.5-8.4-26-20.2-34.6-35.4-8.5-15.2-12.8-31.8-12.8-49.7 0-19 4.8-36.5 14.3-52.3s22.3-27.5 38.3-35.1c-4.2-11.4-6.3-22.9-6.3-34.3 0-27 9.1-50.1 27.4-69.1s40.2-28.6 65.7-28.6c11.4 0 22.3 2.1 32.6 6.3 8-16.4 19.5-29.6 34.6-39.7 15-10.1 31.5-15.2 49.4-15.2s34.4 5.1 49.4 15.1c15 10.1 26.6 23.3 34.6 39.7 10.3-4.2 21.1-6.3 32.6-6.3 25.5 0 47.3 9.5 65.4 28.6s27.1 42.1 27.1 69.1c0 12.6-1.9 24-5.7 34.3 16 7.6 28.8 19.3 38.3 35.1 9.5 15.9 14.3 33.4 14.3 52.4zm-266.9 77.1 105.7-158.3c2.7-4.2 3.5-8.8 2.6-13.7-1-4.9-3.5-8.8-7.7-11.4-4.2-2.7-8.8-3.6-13.7-2.9-5 .8-9 3.2-12 7.4l-93.1 140-42.9-42.8c-3.8-3.8-8.2-5.6-13.1-5.4-5 .2-9.3 2-13.1 5.4-3.4 3.4-5.1 7.7-5.1 12.9 0 5.1 1.7 9.4 5.1 12.9l58.9 58.9 2.9 2.3c3.4 2.3 6.9 3.4 10.3 3.4 6.7-.1 11.8-2.9 15.2-8.7z" fill="#1da1f2"></path></svg></span>\n                                            <div class="card-time">${u}</div>\n                                        </div>\n                                    </div>\n                                    <div class="card-content">${r.content}</div>\n                                    <div class="card-footer">\n                                        <div class="card-label" style="background: ${r.tag.bgColor}; color: white;">\n                                            ${r.tag.name}\n                                        </div>\n                                        <div class="bb-fos" onclick="btf.rmf.rightMenuCommentText(&quot;${m}&quot;)">\n                                            <svg style="width:1.60em;height:1.60em;fill:var(--theme-color);overflow:hidden;cursor: pointer;">\n                                                <use xlink:href="#icon-xiaoxi"></use>\n                                            </svg>\n                                        </div>\n                                    </div>\n                                `,i.appendChild(p),imagesLoaded(p,(()=>{l.appended(p),l.layout(),p.style.transition="opacity 0.4s ease, transform 0.4s ease",p.style.opacity="1",p.style.transform="translateY(0)",c++,setTimeout(d,100)}))};d()}));d(),btf.addGlobalFn("pjaxSendOnce",(()=>{l.destroy()}),"removeMsnry"),s&&btf.addEventListenerPjax("click",s,d)}}]},{path:"/life/music/",modules:[n]},{path:"/social/fcircle/",modules:[{init:()=>{const e="blog_feed_cache",t=216e5;let n=[],a=0,o=!1,s=null;const r=document.getElementById("masonry-container"),i=document.getElementById("loading"),l=document.getElementById("no-more"),c=document.getElementById("refresh-btn"),d=document.getElementById("clear-cache-btn"),u=document.getElementById("cache-time"),m=document.getElementById("error-container"),p=document.getElementById("error-message"),g=e=>{e&&(document.getElementById("friend-count").textContent=e.friendCount||0,document.getElementById("success-count").textContent=e.successCount||0,document.getElementById("fail-count").textContent=e.failCount||0,document.getElementById("article-count").textContent=n.length||0)},h=()=>{const n=localStorage.getItem(e);if(!n)return null;const a=JSON.parse(n);return(new Date).getTime()-a.timestamp<t?a:null},f=async(t=!1)=>{try{const o=await fetch("https://feed.miraii.cn/feed");if(!o.ok)throw new Error(`APIè¯·æ±‚å¤±è´¥: ${o.status} ${o.statusText}`);const i=await o.json();if(!i||!Array.isArray(i.items))throw new Error("æ— æ•ˆçš„APIå“åº”æ•°æ®");n=i.items;const l={items:n,meta:{friendCount:i.meta.friend_count||0,successCount:i.meta.success_count||0,failCount:i.meta.fail_count||0},timestamp:(new Date).getTime()};localStorage.setItem(e,JSON.stringify(l)),t&&(btf.scrollToDest(0,500),a=0,r.innerHTML="",s.layout(),x(!0),c.disabled=!0),v(),g(l.meta),k(l.timestamp),m.style.display="none"}catch(e){console.error("æ•°æ®åŠ è½½å¤±è´¥:",e),m.style.display="block",p.textContent=e.message;const t=h();t?(n=t.items,v(),g(t.meta),k(t.timestamp)):(r.innerHTML="",s.layout())}finally{x(!1),c.disabled=!1}},y=()=>{s&&s.destroy(),s=new Masonry(r,{itemSelector:".card",columnWidth:".card",percentPosition:!0,gutter:25,transitionDuration:"0.4s"})};function v(){if(0===n.length)return r.innerHTML='<div class="no-more" style="display:block;">æ²¡æœ‰æ‰¾åˆ°æ–‡ç« æ•°æ®</div>',void(l.style.display="none");const e=Math.min(a+20,n.length);s||y();const t=o=>{if(o>=e)return a=e,void(l.style.display=a>=n.length?"block":"none");const i=n[o],c=b(i);imagesLoaded(c,(()=>{r.appendChild(c),s.appended(c),s.layout(),c.classList.add("visible"),setTimeout((()=>{t(o+1)}),30)}))};t(a)}const b=e=>{const t=document.createElement("div");t.className="card";const n=e.published?new Date(e.published):new Date,a=`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`;return t.innerHTML=`\n                                <div class="card-header">\n                                    <h3 class="card-title">   \n                                         <a href="${e.link}" target="_blank" rel="noopener noreferrer">\n                                           ğŸ“ ${e.title}\n                                         </a>\n                                    </h3>\n                                    <div class="card-author">\n                                        <img src="${e.avatar}" alt="${e.author}" class="avatar" loading="lazy" onerror="this.onerror=null;this.src='https://miraii.cn/assets/r1.webp';">\n                                        <div>\n                                            <div class="author-name">${e.author}</div>\n                                            <div class="card-date">${a}</div>\n                                        </div>\n                                    </div>\n                                 </div>\n                            <div class="fc-card-content">\n                              ${w(e.content)||"æš‚æ— å†…å®¹"}â€¦\n                            </div>\n                            `,t},w=e=>e?e.replace(/<br\s*\/?>/gi,"\n").replace(/\uFFFD/g,"").trim():"",S=btf.throttle((()=>{o||document.documentElement.scrollTop+window.innerHeight>=document.documentElement.scrollHeight-400&&M()}),150),M=()=>{a>=n.length||o||(o=!0,x(!0),setTimeout((()=>{v(),o=!1,x(!1)}),300))},x=e=>{i.style.display=e?"block":"none"},k=e=>{if(!e)return void(u.textContent="--:--:--");const n=new Date(e+t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});u.textContent=`${n}`};(async()=>{const e=h();x(!0),e?(n=e.items,v(),g(e.meta),k(e.timestamp)):await f(),x(!1)})(),window.addEventListener("scroll",S),c.addEventListener("click",btf.debounce((()=>{f(!0)}),300)),d.addEventListener("click",btf.debounce((()=>{localStorage.removeItem(e),f(!0)}),300)),btf.addGlobalFn("pjaxSendOnce",(()=>{s.destroy()}),"removeFcirleMasonry")}}]},{path:"/site/census/",modules:[{init:async()=>{await(async()=>{const t=new Date,n=new Date(t.setHours(0,0,0,0)),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1),o=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1,23,59,59,999),s=new Date(t.getFullYear(),t.getMonth(),1);try{const[t,r,i]=await Promise.all([e.fetchUmami(a,o,e.umiToken),e.fetchUmami(n,new Date,e.umiToken),e.fetchUmami(s,new Date,e.umiToken)]),l=["ä»Šæ—¥äººæ•°","æ˜¨æ—¥äººæ•°","ä»Šæ—¥è®¿é—®","æ˜¨æ—¥è®¿é—®","æœ¬æœˆè®¿é—®"],c=[r.visitors?.value||0,t.visitors?.value||0,r.pageviews?.value||0,t.pageviews?.value||0,i.pageviews?.value||0],d=document.querySelector("#statisticW .content");if(!d)return void console.log("Domå…ƒç´ ä¸å­˜åœ¨");let u=[];for(let e=0;e<c.length;e++)d.innerHTML+=`<div><span>${l[e]}</span><span id="${l[e]}" class="num">${c[e]}</span></div>`,queueMicrotask((()=>{u.push(new CountUp(l[e],0,c[e],0,2,{useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""}))}));let m=document.querySelector("#statisticW .content");m&&new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){for(let e=0;e<c.length;e++)queueMicrotask((()=>{u[e].start()}));t.disconnect()}}))}),{root:null,rootMargin:"0px",threshold:0}).observe(m)}catch(e){console.log("è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥ï¼š",e)}})()}}]}],i=[s,a,o,t],l=()=>{const e=window.location.pathname;/^\/(?:page\/\d+\/|)$/.test(window.location.pathname)&&i.forEach((e=>e.init?.()));for(const t of r)if(e.startsWith(t.path)){t.modules.forEach((e=>e.init?.()));break}};btf.addGlobalFn("pjaxComplete",l,"removerModuleInit"),l()}));