document.addEventListener("DOMContentLoaded",(function(){const e={formatDateTime:e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},umiToken:"fM7+vUSp/wpEp/mp0LxXrjS46tMQWimFhssZdUuj2SADnmGfHo5rZMOh4PpYSumeLcUNt4a2+q0TNW6VH5vymKH3YFxPNxOm28yjdAAHD/Tew66V/8Ad/K9dXxULUuMWaSL2hUS2zTGIZWipOYUHzkjRFwShDAYQwfbgOGrmgW/P36qqr9FaZaKt9LYVkbY9hQKQ4tRTlhc8zFgwIn/q3Rw/ot7G0HVprAk3PwBkEdyDfPQd7kchi/f+g1g+1X856/v0O7GirvBeQQ7TPhi4/H0/kNm+ZABPDk6+VomlMNnYdZi1KiW90SfTOcUDlvObyKUbCsQpl/LMiDeAtby+0pzkqaSLSpsr7Y5eoR4pDP4Wt+RaZkkHjawJfYjc",fetchUmami:async(e,t,a)=>{try{if(!e||!t||!a)throw new Error("参数 startAt、endAt 或 umiToken 不完整");const n=new URL("https://umami.aimiliy.top/api/websites/3348d0ad-813b-4d17-98d2-d5404445f786/stats");n.searchParams.append("startAt",e.getTime()),n.searchParams.append("endAt",t.getTime());const o=await fetch(n.toString(),{method:"GET",cache:"default",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!o.ok)throw new Error(`请求失败，状态码：${o.status} ${o.statusText}`);return await o.json()}catch(e){throw console.error("获取 umami 统计数据失败：",e.message),e}},removeAllHtmlTags:e=>`“${e.replace(/<[^>]+>.*?<\/[^>]+>|<[^>]+\/>|<[^>]+>/gis,"").trim()}”`,contentFormat:e=>{let t=e.match(/(http(.*).[jpg|png|gif])/g);e=(e=e.replace(/<img(.*?)src=[\"|\']?(.*?)[\"|\']?(.*?)>|!\[(.*?)\]\((.*?)\)/g,"")).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");let a="<br>";return t&&t.forEach((e=>{a+='<a href="'+e+'" target="_blank" data-fancybox="group" class="fancybox"><img src="'+e+'" style="max-width: 100%; object-fit: cover; border-radius: 10px;margin-top: 10px"></a>'})),(e+=a).replace(/(<br\s*\/?>)+$/,"")}},t=[{path:"/personal/about/",modules:[{init:async()=>{await(async()=>{const t="fM7+vUSp/wpEp/mp0LxXrjS46tMQWimFhssZdUuj2SADnmGfHo5rZMOh4PpYSumeLcUNt4a2+q0TNW6VH5vymKH3YFxPNxOm28yjdAAHD/Tew66V/8Ad/K9dXxULUuMWaSL2hUS2zTGIZWipOYUHzkjRFwShDAYQwfbgOGrmgW/P36qqr9FaZaKt9LYVkbY9hQKQ4tRTlhc8zFgwIn/q3Rw/ot7G0HVprAk3PwBkEdyDfPQd7kchi/f+g1g+1X856/v0O7GirvBeQQ7TPhi4/H0/kNm+ZABPDk6+VomlMNnYdZi1KiW90SfTOcUDlvObyKUbCsQpl/LMiDeAtby+0pzkqaSLSpsr7Y5eoR4pDP4Wt+RaZkkHjawJfYjc",a=new Date,n=new Date(a.setHours(0,0,0,0)),o=new Date(a.getFullYear(),a.getMonth(),a.getDate()-1),i=new Date(a.getFullYear(),a.getMonth(),a.getDate()-1,23,59,59,999),r=new Date(a.getFullYear(),a.getMonth(),1),s=new Date(2024,1,1);s.setHours(0,0,0,0);try{const[a,l,c,d]=await Promise.all([e.fetchUmami(o,i,t),e.fetchUmami(n,new Date,t),e.fetchUmami(r,new Date,t),e.fetchUmami(s,new Date,t)]),m=["最近活跃","今日人数","今日访问","昨日人数","昨日访问","本月访问","总访问量"],u=[null,l.visitors?.value||0,l.pageviews?.value||0,a.visitors?.value||0,a.pageviews?.value||0,c.pageviews?.value||0,d.pageviews?.value||0];let g=document.getElementById("statistic");if(!g)return void console.log("Dom元素不存在");let h=[];for(let e=0;e<u.length;e++)0!==e&&(g.innerHTML+=`<div><span>${m[e]}</span><span id="${m[e]}">${u[e]}</span></div>`,queueMicrotask((()=>{h.push(new CountUp(m[e],0,u[e],0,2,{useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""}))})));let p=document.querySelector(".about-statistic.author-content-item");p&&new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){for(let e=0;e<u.length;e++)0!==e&&queueMicrotask((()=>{h[e-1].start()}));t.disconnect()}}))}),{root:null,rootMargin:"0px",threshold:0}).observe(p)}catch(e){console.log("获取统计数据失败：",e)}let l=null;l=setInterval((function(){const e=document.querySelector("span[data-show]"),t=e.nextElementSibling||document.querySelector(".first-tips"),a=document.querySelector("span[data-up]");a&&a.removeAttribute("data-up"),e.removeAttribute("data-show"),e.setAttribute("data-up",""),t.setAttribute("data-show","")}),2e3),document.addEventListener("pjax:send",(function(){l&&clearInterval(l)}))})()}}]},{path:"/personal/bb/",modules:[{init:()=>{let t=0,a=0,n=[],o=1;const i=document.getElementById("more"),r=document.getElementById("bb_loading");let s=document.getElementById("bb-main");const l=new Masonry(s,{itemSelector:".bb-card",columnWidth:".bb-card",gutter:10,percentPosition:!0});let c=!1;const d=async()=>{if(!c){c=!0,i.style.display="none",r.style.display="block";try{const e=await fetch(`https://linghua.aimiliy.top/api/bb/list?page=${o}&size=12`);if(!e.ok)throw new Error("网络错误: "+e.status);const i=await e.json();t=i.data.total,n=i.data.items,a+=n.length,1===o&&(document.querySelector(".bb-info").innerHTML=`\n                                <svg style="width:1.20em;height:1.20em;top:5px;fill:currentColor;overflow:hidden;position:relative">\n                                    <use xlink:href="#icon-chat"></use>\n                                </svg> 站长的日常分享(${t})\n                            `),o+=1,await m()}catch(e){console.error("获取数据失败:",e),btf.$notify("加载失败","当前网络异常，请稍后重试","error",3e3)}finally{r.style.display="none",a<t&&(i.style.display="block"),c=!1}}},m=()=>new Promise((o=>{let c=0;setTimeout((()=>{r.style.display="none"}),300);const d=()=>{if(c>=n.length)return a<t&&(i.style.display="block"),void o();const r=n[c],m=e.formatDateTime(r.createdAt);r.content=e.contentFormat(r.content);const u=e.removeAllHtmlTags(r.content),g=document.createElement("div");g.className="bb-card",g.style.opacity="0",g.style.transform="translateY(20px)",g.innerHTML=`\n                                    <div class="card-header">\n                                        <div class="avatar">\n                                            <img class="nofancybox" src="${r.author.avatar}">\n                                        </div>\n                                        <div class="bb-info-avatar">\n                                            <span><div class="name">${r.author.nickName}</div><svg  viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" class="is-badge"><path  d="m512 268c0 17.9-4.3 34.5-12.9 49.7s-20.1 27.1-34.6 35.4c.4 2.7.6 6.9.6 12.6 0 27.1-9.1 50.1-27.1 69.1-18.1 19.1-39.9 28.6-65.4 28.6-11.4 0-22.3-2.1-32.6-6.3-8 16.4-19.5 29.6-34.6 39.7-15 10.2-31.5 15.2-49.4 15.2-18.3 0-34.9-4.9-49.7-14.9-14.9-9.9-26.3-23.2-34.3-40-10.3 4.2-21.1 6.3-32.6 6.3-25.5 0-47.4-9.5-65.7-28.6-18.3-19-27.4-42.1-27.4-69.1 0-3 .4-7.2 1.1-12.6-14.5-8.4-26-20.2-34.6-35.4-8.5-15.2-12.8-31.8-12.8-49.7 0-19 4.8-36.5 14.3-52.3s22.3-27.5 38.3-35.1c-4.2-11.4-6.3-22.9-6.3-34.3 0-27 9.1-50.1 27.4-69.1s40.2-28.6 65.7-28.6c11.4 0 22.3 2.1 32.6 6.3 8-16.4 19.5-29.6 34.6-39.7 15-10.1 31.5-15.2 49.4-15.2s34.4 5.1 49.4 15.1c15 10.1 26.6 23.3 34.6 39.7 10.3-4.2 21.1-6.3 32.6-6.3 25.5 0 47.3 9.5 65.4 28.6s27.1 42.1 27.1 69.1c0 12.6-1.9 24-5.7 34.3 16 7.6 28.8 19.3 38.3 35.1 9.5 15.9 14.3 33.4 14.3 52.4zm-266.9 77.1 105.7-158.3c2.7-4.2 3.5-8.8 2.6-13.7-1-4.9-3.5-8.8-7.7-11.4-4.2-2.7-8.8-3.6-13.7-2.9-5 .8-9 3.2-12 7.4l-93.1 140-42.9-42.8c-3.8-3.8-8.2-5.6-13.1-5.4-5 .2-9.3 2-13.1 5.4-3.4 3.4-5.1 7.7-5.1 12.9 0 5.1 1.7 9.4 5.1 12.9l58.9 58.9 2.9 2.3c3.4 2.3 6.9 3.4 10.3 3.4 6.7-.1 11.8-2.9 15.2-8.7z" fill="#1da1f2"></path></svg></span>\n                                            <div class="card-time">${m}</div>\n                                        </div>\n                                    </div>\n                                    <div class="card-content">${r.content}</div>\n                                    <div class="card-footer">\n                                        <div class="card-label" style="background: ${r.tag.bgColor}; color: white;">\n                                            ${r.tag.name}\n                                        </div>\n                                        <div class="bb-fos" onclick="btf.rmf.rightMenuCommentText(&quot;${u}&quot;)">\n                                            <svg style="width:1.60em;height:1.60em;fill:var(--theme-color);overflow:hidden;cursor: pointer;">\n                                                <use xlink:href="#icon-xiaoxi"></use>\n                                            </svg>\n                                        </div>\n                                    </div>\n                                `,s.appendChild(g),imagesLoaded(g,(()=>{l.appended(g),l.layout(),g.style.transition="opacity 0.4s ease, transform 0.4s ease",g.style.opacity="1",g.style.transform="translateY(0)",c++,setTimeout(d,100)}))};d()}));d(),btf.addGlobalFn("pjaxSendOnce",(()=>{l.destroy()}),"removeMsnry"),i&&btf.addEventListenerPjax("click",i,d,"click-more-button")}}]},{path:"/life/music/",modules:[{init:()=>{const e={defaultMusic:{id:"7397995017",type:"playlist",server:"tencent"},canvas:document.getElementById("visualizer"),visualizer:{fftSize:256,smoothing:.9,shadowBlur:15}},t=e.canvas.getContext("2d");let a,n,o,i,r,s,l,c,d,m=.8;function u(e=!0){const t=document.getElementById("an_music_bg"),a=document.getElementById("anMusic-page"),n=e=>{if(!e)return;t.style.backgroundImage=e.style.backgroundImage;let a=e.querySelector("div.child");a||(a=document.createElement("div"),a.classList.add("child"),e.appendChild(a)),a.style.backgroundImage=e.style.backgroundImage};if(e){const e=document.querySelector("#anMusic-page .aplayer-pic");n(e)}else{a.classList.add("music-loader-shadow"),btf.setMusicLoading.add(a);const e=new MutationObserver((()=>{const t=document.querySelector("#anMusic-page .aplayer-pic");t&&(btf.setMusicLoading.remove(a),document.body.style.background="rgb(13, 13, 13)",a.classList.remove("music-loader-shadow"),e.disconnect(),n(t),g())}));e.observe(document.body,{childList:!0,subtree:!0})}}const g=()=>{const a=document.getElementById("anMusic-page"),n=a.querySelector(".aplayer-info .aplayer-time .aplayer-icon-menu"),i=a.querySelector("#anMusicBtnGetSong"),r=a.querySelector("#anMusicRefreshBtn"),s=a.querySelector("#anMusicSwitching"),c=document.getElementById("menu-mask"),d=a.querySelector("meting-js").aplayer;btf.addGlobalFn("pjaxSendOnce",(()=>{d&&d.destroy()}),"anMusicDestroy"),d.volume(m,!0),d.on("loadeddata",u),e.canvas.width=window.innerWidth>1500?1500:.95*window.innerWidth;const g=document.querySelector("#anMusic-page .aplayer-pic"),p=document.querySelector("#anMusic-page .aplayer-pic .child"),v=e=>{p&&(p.style.animationPlayState=e)};d.on("play",(()=>{g.classList.contains("turn-around")||g.classList.add("turn-around"),v("running");const e=d.audio;"suspended"===o.state&&o.resume(),h(e);const t=d.list.audios[d.list.index];"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:t.name,artist:t.artist,album:t.artist,artwork:[{src:t.cover||""}]}))})),d.on("pause",(()=>{g.classList.contains("turn-around")&&g.classList.remove("turn-around"),v("paused"),setTimeout((()=>{window.cancelAnimationFrame(l),t.clearRect(0,0,e.canvas.width,e.canvas.height)}),1e3)}));const y=btf.throttle((()=>{e.canvas.width=window.innerWidth>1500?1500:.95*window.innerWidth}),100,{leading:!0,trailing:!0}),f=btf.debounce((()=>{k(d)}),300,!0),S=btf.debounce((()=>{E().then((e=>{}))}),300,!0),x=btf.debounce((()=>{M().then((e=>{}))}),300,!0),L=btf.debounce((e=>{C(e,d)}),200,!0);[{event:"resize",selector:window,callback:y,eventName:"onCanvasResize"},{event:"click",selector:n,callback:b,eventName:"openMenu"},{event:"click",selector:c,callback:w,eventName:"closeMenu"},{event:"click",selector:i,callback:f,eventName:"onPlayRandomSongClick"},{event:"click",selector:r,callback:S,eventName:"onRefreshMusicListClick"},{event:"click",selector:s,callback:x,eventName:"onChangeMusicListClick"},{event:"onbeforeunload",selector:document,callback:()=>{d&&d.destroy()},eventName:"onDestroyBeforeunload"},{event:"keydown",selector:document,callback:L,eventName:"onKeydownHandleKeyboardEvents"}].forEach((e=>{btf.addEventListenerPjax(e.event,e.selector,e.callback,e.eventName)})),btf.addGlobalFn("pjaxSendOnce",(()=>{window.cancelAnimationFrame(l),t.clearRect(0,0,e.canvas.width,e.canvas.height)}),"musicCanvasDestroy")},h=e=>{s||(s=e,r=o.createMediaElementSource(s),r.connect(i),i.connect(o.destination)),f()},p=e=>{const t=e.match(/rgb\((\d+), (\d+), (\d+)\)/);if(!t)throw new Error("Invalid RGB string format");const a=parseInt(t[1],10),n=parseInt(t[2],10),o=parseInt(t[3],10);let i=Math.min(a+40,255),r=Math.min(n+40,255),s=Math.min(o+40,255);return i=i.toString(16).padStart(2,"0"),r=r.toString(16).padStart(2,"0"),s=s.toString(16).padStart(2,"0"),`#${i}${r}${s}`};let v=btf.map.get(localStorage.getItem("themeColor")),y=p(v);const f=()=>{i.getByteFrequencyData(d),t.clearRect(0,0,e.canvas.width,e.canvas.height),v!==btf.map.get(localStorage.getItem("themeColor"))&&(v=btf.map.get(localStorage.getItem("themeColor")),y=p(v));const a=2*c,n=a-1,o=(e.canvas.width-1*n-1)/a,r=e.canvas.width/2,s=t.createLinearGradient(0,0,0,e.canvas.height);s.addColorStop(0,v),t.shadowBlur=15,t.shadowColor=y,t.fillStyle=s;for(let a=0;a<c;a++){const n=.5*d[a],i=o*(1-n/e.canvas.height),s=r-.5-a*(o+1)-o,l=r+.5+a*(o+1);t.beginPath(),t.moveTo(s,e.canvas.height),t.lineTo(s+o,e.canvas.height),t.lineTo(s+o-i/2,e.canvas.height-n),t.lineTo(s+i/2,e.canvas.height-n),t.closePath(),t.fill(),t.beginPath(),t.moveTo(l,e.canvas.height),t.lineTo(l+o,e.canvas.height),t.lineTo(l+o-i/2,e.canvas.height-n),t.lineTo(l+i/2,e.canvas.height-n),t.closePath(),t.fill()}l=requestAnimationFrame(f)},b=()=>{const e=document.getElementById("menu-mask");e.style.display="block",e.style.animation="0.5s ease 0s 1 normal none running to_show",document.querySelector(".aplayer.aplayer-withlist .aplayer-list").style.opacity="1"},w=()=>{document.querySelector(".aplayer-list").classList.remove("aplayer-list-hide")},S=e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e},k=e=>{const t=e.list.audios;if(!t||t.length<2)return;let a;try{if(a=JSON.parse(localStorage.getItem("shuffledPlaylist"))||[],!Array.isArray(a))throw new Error("shuffledPlaylist is not a valid array")}catch(e){a=[],console.log("Error parsing shuffledPlaylist from localStorage:",e)}0!==a.length&&a.length!==t.length||(a=S([...Array(t.length).keys()]));const n=a.shift();localStorage.setItem("shuffledPlaylist",JSON.stringify(a)),e.list.switch(n),e.play()},E=async()=>{const t=document.getElementById("anMusic-page").querySelector("meting-js").aplayer;t.seek(0),t.pause(),a=e.defaultMusic,localStorage.setItem("localMusic",JSON.stringify(e.defaultMusic));const n=x(a);try{const e=await L(n);e.length>0&&(t.list.clear(),t.list.add(e))}catch(e){console.error("Error changing music list:",e)}},M=async()=>{const e=document.getElementById("anMusic-page").querySelector("meting-js").aplayer;let t;localStorage.removeItem("shuffledPlaylist"),e.seek(0),e.pause();try{if(t=JSON.parse(localStorage.getItem("shuffledMusicList"))||[],!Array.isArray(t))throw new Error("shuffledMusicList is not a valid array")}catch(e){t=[],console.log("Error parsing shuffledMusicList from localStorage:",e)}0!==t.length&&t.length!==n.length||(t=S([...Array(n.length).keys()]));let o=t.shift();for(;n[o].id===a.id&&t.length>0;)o=t.shift();localStorage.setItem("shuffledMusicList",JSON.stringify(t)),a=n[o],localStorage.setItem("localMusic",JSON.stringify(a));const i=x(a);try{const t=await L(i);t.length>0&&(e.list.clear(),e.list.add(t))}catch(e){console.error("Error changing music list:",e)}},x=e=>`https://meting-js.miraii.cn/api?server=${e.server}&type=${e.type}&id=${e.id}&auth=undefined&r=${Math.random()*Date.now()}`,L=async e=>{try{const t=await fetch(e);return t.ok?await t.json():[]}catch(e){return console.error("Error fetching songs:",e),[]}},C=(e,t)=>{switch(e.code){case"Space":e.preventDefault(),t.toggle();break;case"ArrowRight":e.preventDefault(),t.skipForward();break;case"ArrowLeft":e.preventDefault(),t.skipBack();break;case"ArrowUp":m<=1&&(m+=.1,t.volume(m,!0));break;case"ArrowDown":m>=0&&(m-=.1,t.volume(m,!0))}};document.getElementById("anMusic-page-meting").innerHTML='<meting-js id="7397995017" server="tencent" type="playlist" mutex="true" preload="auto" theme="var(--theme-color)" order="list" list-max-height="320px"></meting-js>',(()=>{try{a=JSON.parse(localStorage.getItem("localMusic"))||e.defaultMusic}catch{a=e.defaultMusic,localStorage.removeItem("localMusic")}localStorage.setItem("defaultMusic",JSON.stringify(e.defaultMusic)),localStorage.setItem("localMusic",JSON.stringify(a))})(),o=new(window.AudioContext||window.webkitAudioContext),i=o.createAnalyser(),i.fftSize=e.visualizer.fftSize,i.smoothingTimeConstant=e.visualizer.smoothing,c=i.frequencyBinCount,d=new Uint8Array(c),btf.addGlobalFn("pjaxSendOnce",(()=>{o&&o.close().then((()=>{o=null,i=null,r=null,s=null})).catch((e=>{console.error("Error closing audio context:",e)}))}),"audioContextDestory"),(async()=>{if(!n)try{const e=await fetch("https://cdn.aimiliy.top/npm/json/musicListCache.json");n=e.ok?await e.json():[{id:"7397995017",type:"playlist",server:"tencent"}]}catch(e){n=[{id:"7397995017",type:"playlist",server:"tencent"}],console.log("fetch remote musicList error:",e)}})(),u(!1)}}]},{path:"/social/fcircle/",modules:[(()=>{const e=()=>{UserConfig={private_api_url:UserConfig?.private_api_url||"",page_turning_number:UserConfig?.page_turning_number||20,error_img:UserConfig?.error_img||"https://fastly.jsdelivr.net/gh/willow-god/Friend-Circle-Lite@latest/static/favicon.ico"};const e=document.getElementById("friend-circle-lite-root");if(!e)return;e.innerHTML="";const t=document.createElement("div");t.id="random-article",e.appendChild(t);const a=document.createElement("div");a.className="articles-container",a.id="articles-container",e.appendChild(a);const n=document.createElement("button");n.id="load-more-btn",n.innerText="再来亿点",e.appendChild(n);const o=document.createElement("div");o.id="stats-container",e.appendChild(o);let i=0,r=[];const s=()=>{const e="friend-circle-lite-cache",t="friend-circle-lite-cache-time",a=localStorage.getItem(t),o=(new Date).getTime();if(a&&o-a<6e5){const t=JSON.parse(localStorage.getItem(e));if(t)return void l(t)}fetch(`${UserConfig.private_api_url}all.json`).then((e=>e.json())).then((a=>{localStorage.setItem(e,JSON.stringify(a)),localStorage.setItem(t,o.toString()),l(a)})).finally((()=>{n.innerText="再来亿点"}))},l=e=>{r=e.article_data;const t=e.statistical_data;o.innerHTML=`\n            <div>Powered by: <a href="https://github.com/willow-god/Friend-Circle-Lite" target="_blank">FriendCircleLite</a><br></div>\n            <div>Designed By: <a href="https://www.liushen.fun/" target="_blank">LiuShen</a><br></div>\n            <div>订阅:${t.friends_num}   活跃:${t.active_num}   总文章数:${t.article_num}<br></div>\n            <div>更新时间:${t.last_updated_time}</div>\n        `,c();r.slice(i,i+UserConfig.page_turning_number).forEach((e=>{const t=document.createElement("div");t.className="card";const n=document.createElement("div");n.className="card-title",n.innerText=e.title,t.appendChild(n),n.onclick=()=>window.open(e.link,"_blank");const o=document.createElement("div");o.className="card-author";const i=document.createElement("img");i.className="no-lightbox",i.src=e.avatar||UserConfig.error_img,i.onerror=()=>i.src=UserConfig.error_img,o.appendChild(i),o.appendChild(document.createTextNode(e.author)),t.appendChild(o),o.onclick=()=>{d(e.author,e.avatar,e.link)};const r=document.createElement("div");r.className="card-date",r.innerText="🗓️"+e.created.substring(0,10),t.appendChild(r);const s=document.createElement("img");s.className="card-bg no-lightbox",s.src=e.avatar||UserConfig.error_img,s.onerror=()=>s.src=UserConfig.error_img,t.appendChild(s),a.appendChild(t)})),i+=UserConfig.page_turning_number,i>=r.length&&(n.style.display="none")},c=()=>{const e=r[Math.floor(Math.random()*r.length)];t.innerHTML=`\n            <div class="random-container">\n                <div class="random-container-title">随机钓鱼</div>\n                <div class="random-title">${e.title}</div>\n                <div class="random-author">作者: ${e.author}</div>\n            </div>\n            <div class="random-button-container">\n                <a href="#" id="refresh-random-article">刷新</a>\n                <button class="random-link-button" onclick="window.open('${e.link}', '_blank')">过去转转</button>\n            </div>\n        `;document.getElementById("refresh-random-article").addEventListener("click",(function(e){e.preventDefault(),c()}))},d=(t,a,n)=>{if(!document.getElementById("fclite-modal")){const t=document.createElement("div");t.id="modal",t.className="modal",t.innerHTML='\n            <div class="modal-content">\n                <img id="modal-author-avatar" src="" alt="">\n                <a id="modal-author-name-link"></a>\n                <div id="modal-articles-container"></div>\n                <img id="modal-bg" src="" alt="">\n            </div>\n            ',e.appendChild(t)}const o=document.getElementById("modal"),i=document.getElementById("modal-articles-container"),s=document.getElementById("modal-author-avatar"),l=document.getElementById("modal-author-name-link"),c=document.getElementById("modal-bg");i.innerHTML="",s.src=a||UserConfig.error_img,s.onerror=()=>s.src=UserConfig.error_img,c.src=a||UserConfig.error_img,c.onerror=()=>c.src=UserConfig.error_img,l.innerText=t,l.href=new URL(n).origin;r.filter((e=>e.author===t)).slice(0,4).forEach((e=>{const t=document.createElement("div");t.className="modal-article";const a=document.createElement("a");a.className="modal-article-title",a.innerText=e.title,a.href=e.link,a.target="_blank",t.appendChild(a);const n=document.createElement("div");n.className="modal-article-date",n.innerText="📅"+e.created.substring(0,10),t.appendChild(n),i.appendChild(t)})),o.style.display="block",setTimeout((()=>{o.classList.add("modal-open")}),10)};s(),btf.addEventListenerPjax("click",n,s,"loadMoreArticles");btf.addEventListenerPjax("click",window,(t=>{const a=document.getElementById("modal");t.target===a&&(()=>{const t=document.getElementById("modal");t.classList.remove("modal-open"),btf.addEventListenerPjax("transitionend",t,(()=>{t.style.display="none",e.removeChild(t)}),"modalFun",{once:!0})})()}),"closeModal")};return{init:()=>{e()}}})()]},{path:"/site/census/",modules:[{init:async()=>{await(async()=>{const t=new Date,a=new Date(t.setHours(0,0,0,0)),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1),o=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1,23,59,59,999),i=new Date(t.getFullYear(),t.getMonth(),1);try{const[t,r,s]=await Promise.all([e.fetchUmami(n,o,e.umiToken),e.fetchUmami(a,new Date,e.umiToken),e.fetchUmami(i,new Date,e.umiToken)]),l=["今日人数","昨日人数","今日访问","昨日访问","本月访问"],c=[r.visitors?.value||0,t.visitors?.value||0,r.pageviews?.value||0,t.pageviews?.value||0,s.pageviews?.value||0],d=document.querySelector("#statisticW .content");if(!d)return void console.log("Dom元素不存在");let m=[];for(let e=0;e<c.length;e++)d.innerHTML+=`<div><span>${l[e]}</span><span id="${l[e]}" class="num">${c[e]}</span></div>`,queueMicrotask((()=>{m.push(new CountUp(l[e],0,c[e],0,2,{useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""}))}));let u=document.querySelector("#statisticW .content");u&&new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){for(let e=0;e<c.length;e++)queueMicrotask((()=>{m[e].start()}));t.disconnect()}}))}),{root:null,rootMargin:"0px",threshold:0}).observe(u)}catch(e){console.log("获取统计数据失败：",e)}})()}}]},{path:"/social/link/",modules:[{init:()=>{ScrollReveal({distance:"20px",duration:800,delay:100,easing:"cubic-bezier(0.25, 0.8, 0.25, 1)",reset:!1}).reveal(".site-card",{origin:"bottom",opacity:0,scale:.8,mobile:!1}),btf.addGlobalFn("pjaxSendOnce",(()=>{document.querySelectorAll("[data-sr-id]").forEach((e=>{e.removeAttribute("data-sr-id"),e.style.removeProperty("visibility"),e.style.removeProperty("opacity"),e.style.removeProperty("transform"),e.style.removeProperty("transition")})),document.documentElement.classList.remove("sr")}),"removeSiteCard")}}]}],a=[{init:()=>{ScrollReveal({distance:"30px",duration:1e3,delay:200,easing:"cubic-bezier(0.25, 0.8, 0.25, 1)",reset:!1}).reveal(".wow",{origin:"bottom",opacity:0,scale:.5,mobile:!1}),btf.addGlobalFn("pjaxSendOnce",(()=>{document.querySelectorAll("[data-sr-id]").forEach((e=>{e.removeAttribute("data-sr-id"),e.style.removeProperty("visibility"),e.style.removeProperty("opacity"),e.style.removeProperty("transform"),e.style.removeProperty("transition")})),document.documentElement.classList.remove("sr")}),"scrollRevealDestory")}},{init:()=>{const e=document.getElementById("swiper_container");e&&new IntersectionObserver(((t,a)=>{t.forEach((t=>{if(t.isIntersecting){const t=new Swiper(".blog-slider",{passiveListeners:!0,spaceBetween:30,effect:"fade",loop:!0,autoplay:{disableOnInteraction:!0,delay:5e3},mousewheel:!0,pagination:{el:".blog-slider__pagination",clickable:!0}}),n=()=>t.autoplay.stop(),o=()=>t.autoplay.start();btf.addEventListenerPjax("mouseenter",e,n,"swiper-mouseenter"),btf.addEventListenerPjax("mouseleave",e,o,"swiper-mouseleave");const i=()=>{"hidden"===document.visibilityState?t.autoplay.stop():"visible"===document.visibilityState&&t.autoplay.start()};btf.addEventListenerPjax("visibilitychange",document,i,"visibilitychangeSwiper"),btf.addGlobalFn("pjaxSendOnce",(()=>{t.destroy(!0,!0)}),"swiperModuleDestory"),a.disconnect()}}))}),{root:null,rootMargin:"0px",threshold:.08}).observe(e)}},{init:async()=>{let t=[];const a=document.getElementById("bb-talk");let n=null,o=0,i=0,r=null,s=0;const l=()=>{n||(n=setInterval(c,4e3))},c=()=>{o++,r.style.transition="transform 0.5s ease-in-out",r.style.transform=`translateY(${-o*s}px)`,o===i&&setTimeout((()=>{r.style.transition="none",r.style.transform="translateY(0px)",o=0}),510)};try{const a=await fetch("https://linghua.aimiliy.top/api/bb/list?page=1&size=6");if(!a.ok)throw new Error("网络错误: "+a.status);t=(await a.json()).data.items.map((t=>e.removeAllHtmlTags(e.contentFormat(t.content))))}catch(e){console.error("获取数据失败:",e),t=["<b>加载失败</b>，请稍后再试~"]}r=document.createElement("div"),r.className="bb-track",r.style.transition="transform 0.5s ease-in-out",a.appendChild(r),t.forEach((e=>{const t=document.createElement("div");t.className="bb-item",t.innerHTML=e,r.appendChild(t)}));const d=r.children[0].cloneNode(!0);r.appendChild(d),i=t.length,s=r.children[0].offsetHeight,l(),btf.addEventListenerPjax("visibilitychange",document,(()=>{document.hidden?n&&(clearInterval(n),n=null):l()}),"bbHandleVisibilityChange")}}],n=()=>{const e=window.location.pathname;/^\/(?:page\/\d+\/|)$/.test(window.location.pathname)&&a.forEach((e=>e.init?.()));for(const a of t)if(e.startsWith(a.path)){a.modules.forEach((e=>e.init?.()));break}};btf.addGlobalFn("pjaxComplete",n,"removerModuleInit"),n()}));