var musicPlayerModule=function(){const e={id:"7397995017",type:"playlist",server:"tencent"};var t=JSON.parse(localStorage.getItem("localMusic"))||e,a=.8,n=null;function i(e=!0){if("/life/music/"!==window.location.pathname)return;const t=document.getElementById("an_music_bg");if(e){const e=document.querySelector("#anMusic-page .aplayer-pic");t.style.backgroundImage=e.style.backgroundImage}else{let e=setInterval((()=>{const n=document.querySelector("#anMusic-page .aplayer-pic");n&&(clearInterval(e),t.style.backgroundImage=n.style.backgroundImage,function(){const e=window.aplayers[0];e.volume(a,!0),e.on("loadeddata",i);const t=document.getElementById("anMusic-page"),n=t.querySelector(".aplayer-info .aplayer-time .aplayer-icon-menu"),u=t.querySelector("#anMusicBtnGetSong"),d=t.querySelector("#anMusicRefreshBtn"),y=t.querySelector("#anMusicSwitching");n.removeEventListener("click",l),u.removeEventListener("click",(()=>o(e))),d.removeEventListener("click",s),y.removeEventListener("click",r),n.addEventListener("click",l),document.getElementById("menu-mask").addEventListener("click",c),u.addEventListener("click",(()=>o(e))),d.addEventListener("click",s),y.addEventListener("click",r),document.addEventListener("keydown",(t=>function(e,t){switch(e.code){case"Space":e.preventDefault(),t.toggle();break;case"ArrowRight":e.preventDefault(),t.skipForward();break;case"ArrowLeft":e.preventDefault(),t.skipBack();break;case"ArrowUp":a<=1&&(a+=.1,t.volume(a,!0));break;case"ArrowDown":a>=0&&(a-=.1,t.volume(a,!0))}}(t,e)))}())}),100)}}function l(){const e=document.getElementById("menu-mask");e.style.display="block",e.style.animation="0.5s ease 0s 1 normal none running to_show",document.querySelector(".aplayer.aplayer-withlist .aplayer-list").style.opacity="1"}function c(){"/life/music/"===window.location.pathname&&document.querySelector(".aplayer-list").classList.remove("aplayer-list-hide")}function o(e){const t=e.list.audios,a=Math.floor(Math.random()*t.length);e.list.switch(a)}async function s(){const a=window.aplayers[0];t=e,localStorage.setItem("localMusic",JSON.stringify(e));const n=u(t),i=await d(n);i.length>0&&(a.list.clear(),a.list.add(i))}async function r(){const e=window.aplayers[0];let a;do{a=n[Math.floor(Math.random()*n.length)]}while(JSON.parse(localStorage.getItem("localMusic")).id===a.id);t=a,localStorage.setItem("localMusic",JSON.stringify(a));const i=u(a),l=await d(i);l.length>0&&(e.list.clear(),e.list.add(l))}function u(e){return`https://twikoo.aimiliy.top/music/api?server=${e.server}&type=${e.type}&id=${e.id}&auth=undefined&r=${Math.random()*Date.now()}`}async function d(e){try{const t=await fetch(e);return t.ok?await t.json():[]}catch(e){return[]}}return{init:async function(){localStorage.getItem("defaultMusic")||localStorage.setItem("defaultMusic",JSON.stringify(e)),localStorage.getItem("localMusic")||localStorage.setItem("localMusic",JSON.stringify(t)),i(!1),await async function(){if(!n)try{const e=await fetch("https://cdn.aimiliy.top/npm/json/musicListCache.json");n=e.ok?await e.json():[{id:"7397995017",type:"playlist",server:"tencent"}]}catch(e){n=[{id:"7397995017",type:"playlist",server:"tencent"}]}}()}}}();function initializeVirtualList(){const e=setInterval((()=>{if(window.aplayers&&window.aplayers[0]){clearInterval(e);const t=window.aplayers[0].container.getElementsByClassName("aplayer-list"),a=33,n=5,i=Math.ceil(t.clientHeight/a)+n;renderVirtualizedList(window.aplayers[0],t,a,i),t.addEventListener("scroll",(function(){renderVirtualizedList(window.aplayers[0],t,a,i)}))}}),100)}function renderVirtualizedList(e,t,a,n){const i=e.list.audios.length,l=t[0].scrollTop,c=Math.floor(l/a),o=Math.min(c+n,i);e.list.clear();const s=[];for(let t=c;t<o;t++){const a=e.list.audios[t];s.push(a)}e.list.add(s),t.style.paddingTop=c*a+"px"}document.addEventListener("DOMContentLoaded",musicPlayerModule.init),musicPlayerModule.init().catch((e=>{})),initializeVirtualList();