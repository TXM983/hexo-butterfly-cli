var defaultMusic={id:"7397995017",type:"playlist",server:"tencent"},localMusic=JSON.parse(localStorage.getItem("localMusic"))||defaultMusic,musicVolume=.8,musicListCache=null;function initLocalStorage(){localStorage.getItem("defaultMusic")||localStorage.setItem("defaultMusic",JSON.stringify(defaultMusic)),localStorage.getItem("localMusic")||localStorage.setItem("localMusic",JSON.stringify(localMusic))}async function loadMusicListCache(){if(!musicListCache)try{const e=await fetch("https://cdn.aimiliy.top/npm/json/musicListCache.json");musicListCache=e.ok?await e.json():[{id:"7397995017",type:"playlist",server:"tencent"}]}catch(e){musicListCache=[{id:"7397995017",type:"playlist",server:"tencent"}]}}var musicPlayerModule=function(){function e(n=!0){if("/life/music/"!==window.location.pathname)return;const o=document.getElementById("an_music_bg");if(n){const e=document.querySelector("#anMusic-page .aplayer-pic");o.style.backgroundImage=e.style.backgroundImage}else{let n=setInterval((()=>{const s=document.querySelector("#anMusic-page .aplayer-pic");s&&(clearInterval(n),o.style.backgroundImage=s.style.backgroundImage,function(){const n=document.getElementById("anMusic-page"),o=n.querySelector(".aplayer-info .aplayer-time .aplayer-icon-menu"),s=n.querySelector("#anMusicBtnGetSong"),l=n.querySelector("#anMusicRefreshBtn"),r=n.querySelector("#anMusicSwitching"),u=document.getElementById("anMusic-page").querySelector("meting-js").aplayer;u.volume(musicVolume,!0),u.on("loadeddata",e),o.addEventListener("click",t),document.getElementById("menu-mask").addEventListener("click",c),s.addEventListener("click",(()=>function(e){const t=e.list.audios,c=Math.floor(Math.random()*t.length);e.list.switch(c)}(u))),l.addEventListener("click",a),r.addEventListener("click",i),document.addEventListener("onbeforeunload",(()=>{u&&u.destroy()})),document.addEventListener("keydown",(e=>function(e,t){switch(e.code){case"Space":e.preventDefault(),t.toggle();break;case"ArrowRight":e.preventDefault(),t.skipForward();break;case"ArrowLeft":e.preventDefault(),t.skipBack();break;case"ArrowUp":musicVolume<=1&&(musicVolume+=.1,t.volume(musicVolume,!0));break;case"ArrowDown":musicVolume>=0&&(musicVolume-=.1,t.volume(musicVolume,!0))}}(e,u)))}())}),100)}}function t(){const e=document.getElementById("menu-mask");e.style.display="block",e.style.animation="0.5s ease 0s 1 normal none running to_show",document.querySelector(".aplayer.aplayer-withlist .aplayer-list").style.opacity="1"}function c(){"/life/music/"===window.location.pathname&&document.querySelector(".aplayer-list").classList.remove("aplayer-list-hide")}async function a(){const e=document.getElementById("anMusic-page").querySelector("meting-js").aplayer;localMusic=defaultMusic,localStorage.setItem("localMusic",JSON.stringify(defaultMusic));const t=n(localMusic);try{const c=await o(t);c.length>0&&(e.list.clear(),e.list.add(c))}catch(e){console.error("Error changing music list:",e)}}async function i(){const e=document.getElementById("anMusic-page").querySelector("meting-js").aplayer;let t;do{t=musicListCache[Math.floor(Math.random()*musicListCache.length)]}while(JSON.parse(localStorage.getItem("localMusic")).id===t.id);localMusic=t,localStorage.setItem("localMusic",JSON.stringify(t));const c=n(t);try{const t=await o(c);t.length>0&&(e.list.clear(),e.list.add(t))}catch(e){console.error("Error changing music list:",e)}}function n(e){return`https://twikoo.aimiliy.top/music/api?server=${e.server}&type=${e.type}&id=${e.id}&auth=undefined&r=${Math.random()*Date.now()}`}async function o(e){try{const t=await fetch(e);return t.ok?await t.json():[]}catch(e){return console.error("Error fetching songs:",e),[]}}return{init:async function(){e(!1)}}}();function init(){if("/life/music/"!==window.location.pathname)return;document.getElementById("anMusic-page-meting").innerHTML='<meting-js id="7397995017" server="tencent" type="playlist" mutex="true" preload="auto" theme="var(--theme-color)" order="list" list-max-height="320px"></meting-js>',musicPlayerModule.init(!1).catch(console.error)}window.refreshMusic=()=>{init(),initLocalStorage(),loadMusicListCache().then((e=>{}))},refreshMusic();